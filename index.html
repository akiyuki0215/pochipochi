<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ä¿®ç†å—ä»˜ã‚³ãƒ³ã‚µãƒ«ãƒŠãƒ“ï¼ˆæ–°æ½Ÿã‚¨ãƒªã‚¢ç‰ˆï¼‰</title>
<style>
  body{font-family: system-ui,-apple-system,Segoe UI,Roboto,"ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ ProN","Noto Sans JP",sans-serif;background:#f5f7fb;margin:0}
  header{background:linear-gradient(90deg,#0b4aa0,#0e67c1);color:#fff;padding:14px 16px;display:flex;align-items:center;justify-content:space-between}
  header h1{font-size:18px;margin:0}
  header .actions a{display:inline-block;background:#0b5ed7;color:#fff;text-decoration:none;padding:10px 14px;border-radius:10px}
  main{max-width:960px;margin:18px auto;padding:0 12px}
  #crumb{color:#667; font-size:12px; margin:8px 4px}
  .toolbar{display:flex; gap:8px; margin:6px 4px}
  .toolbar button{border:1px solid #cfd6e4;background:#fff;border-radius:10px;padding:8px 12px}
  #panel{background:#fff;border-radius:14px;box-shadow:0 2px 8px rgba(10,30,60,.06);padding:16px;min-height:120px}
  .row{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0}
  .chip{border:1px solid #cfd6e4;background:#f6f9ff;border-radius:999px;padding:10px 14px}
  .section-title{font-weight:700;margin:4px 0 8px 0}
  .result{border-radius:14px;padding:16px;margin:6px 0;border:1px solid transparent}
  .result.ok{background:#ecfbf1;border-color:#c9f0d6}
  .result.ng{background:#ffecec;border-color:#ffcdcd}
  .result.warn{background:#fff9e6;border-color:#ffe8a6}
  .result-title{margin:0 0 8px 0;font-size:16px}
  #history{display:none;margin-top:14px}
  details.history summary{cursor:pointer;list-style:none}
  details.history summary::-webkit-details-marker{display:none}
  details.history{background:#fff;border-radius:14px;border:1px solid #e4e8f1;padding:10px 12px}
  table{width:100%;border-collapse:collapse;margin-top:8px}
  th,td{border-bottom:1px solid #eef2f7;padding:8px 6px;font-size:14px}
  th{color:#556}
  .muted{color:#97a0ad}
  .note{color:#667;font-size:12px}
</style>
</head>
<body>
  <header>
    <h1>ä¿®ç†å—ä»˜ã‚³ãƒ³ã‚µãƒ«ãƒŠãƒ“ï¼ˆæ–°æ½Ÿã‚¨ãƒªã‚¢ç‰ˆï¼‰</h1>
    <div class="actions">
      <a href="https://docs.google.com/forms/d/e/1FAIpQLSc5pwJ5ahRwDdJiZNoXA0kSZ7Y9kufFVLL2kqACfH2yQFpsEA/viewform" target="_blank" rel="noopener">æ„è¦‹ã‚’é€ã‚‹ï¼ˆGoogleãƒ•ã‚©ãƒ¼ãƒ ï¼‰</a>
    </div>
  </header>

  <main>
    <div id="crumb">é€²è¡Œï¼š ãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠ</div>
    <div class="toolbar">
      <button id="backBtn" type="button">â† ã²ã¨ã¤å‰ã¸</button>
      <button id="homeBtn" type="button">æœ€åˆã‹ã‚‰</button>
    </div>
    <div id="panel"></div>

    <div id="history">
      <details class="history">
        <summary>ğŸ•’ æ›´æ–°å±¥æ­´ï¼ˆã‚¿ãƒƒãƒ—ã§é–‹é–‰ï¼‰</summary>
        <div class="note">â€» å±¥æ­´ã¯ <code>update_log.json</code> ã‚’èª­ã¿è¾¼ã¿è¡¨ç¤ºã—ã¾ã™ã€‚</div>
        <table id="historyTable">
          <thead><tr><th>æ—¥ä»˜</th><th>åº—èˆ—å</th><th>åå‰</th><th>æ›´æ–°å†…å®¹</th></tr></thead>
          <tbody><tr><td colspan="4" class="muted">èª­ã¿è¾¼ã¿å¾…æ©Ÿä¸­â€¦</td></tr></tbody>
        </table>
      </details>
    </div>
  </main>

  <script type="module">
    import { ui, app }                            from './core.js';
    import { renderDomestic, renderSurface }      from './vendor_domestic.js';
    import { renderOverseas }                     from './vendor_overseas.js';
    import { renderVAIO }                         from './vendor_vaio.js';
    import { renderApple }                        from './vendor_apple.js';

    function render(screen, arg){
      try{
        if(screen === "home"){ return renderHome(); }
        if(screen === "domestic"){ return renderDomestic(arg); }
        if(screen === "overseas"){ return renderOverseas(arg); }
        if(screen === "vaio"){ return renderVAIO(); }
        if(screen === "surface"){ return renderSurface(); }
        if(screen === "apple"){ return renderApple(); }
        ui.clear();
        ui.panel.innerHTML = '<div class="result warn"><h3 class="result-title">ä¸æ˜ãªç”»é¢</h3><p>ç”»é¢è­˜åˆ¥å­: '+String(screen)+'</p></div>';
      }catch(e){
        console.error(e);
        ui.clear();
        ui.panel.innerHTML = '<div class="result ng"><h3 class="result-title">è¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ</h3><p>'+ (e?.message || e) +'</p></div>';
      }
    }

    function renderHome(){
      ui.clear();
      ui.resetCrumb();

      const g = app.DATA?.groups || {};
      const box = document.createElement("div");

      const makeGroup = (title, makers, clickTo)=>{
        const sec = document.createElement("section");
        sec.append(ui.h2(title));
        const row = ui.rowBox();
        (makers||[]).forEach(m=>{
          row.append(ui.chip(m, ()=> clickTo(m)));
        });
        sec.append(row);
        box.append(sec);
      };

      makeGroup("å›½å†…ãƒ¡ãƒ¼ã‚«ãƒ¼", g.domestic, (m)=> render("domestic", m));
      makeGroup("æµ·å¤–ãƒ¡ãƒ¼ã‚«ãƒ¼", g.overseas, (m)=> render("overseas", m));
      makeGroup("Surface",      g.surface,  ()=> render("surface"));
      makeGroup("Apple",        g.apple,    ()=> render("apple"));

      ui.panel.append(box);
      ui.historyBox.style.display = "";
      ui.renderHistoryOnce();
      ui.pushView("home");
      ui.syncCrumb();
    }

    ui.backBtn.addEventListener("click", ()=> ui.goBack(render));
    ui.homeBtn.addEventListener("click", ()=> ui.goHome(render));

    (async ()=>{
      app.DATA = await ui.safeFetchJSON("data.json");
      if(!app.DATA){
        ui.clear();
        ui.panel.innerHTML = '<div class="result ng"><h3 class="result-title">è¨­å®šã‚¨ãƒ©ãƒ¼</h3><p>data.json ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½ç½®ã¨å½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p></div>';
        return;
      }
      render("home");
    })();
  </script>
</body>
</html>
