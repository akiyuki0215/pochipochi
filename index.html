<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ä¿®ç†å—ä»˜ã‚³ãƒ³ã‚µãƒ«ãƒŠãƒ“ï¼ˆæ–°æ½Ÿã‚¨ãƒªã‚¢ç‰ˆï¼‰</title>
<style>
  body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans JP","Hiragino Kaku Gothic ProN",Meiryo,sans-serif;margin:0;background:#f6f7fb;color:#111}
  header{position:sticky;top:0;background:#0b5bd3;color:#fff;padding:12px 16px;display:flex;justify-content:space-between;align-items:center}
  header .t{font-weight:700}
  header a{color:#fff;text-decoration:none;background:#ffffff22;padding:8px 12px;border-radius:8px}
  .container{max-width:960px;margin:18px auto;padding:0 14px}
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:16px;box-shadow:0 4px 18px rgba(0,0,0,.04);margin-bottom:14px}
  .path{font-size:12px;color:#6b7280;margin-bottom:8px}
  h3{margin:8px 0}
  .btn{display:inline-block;margin:6px 8px 0 0;padding:10px 12px;border:1px solid #d1d5db;border-radius:10px;background:#fff;cursor:pointer}
  .btn:hover{background:#f8fafc}
  .btn.primary{background:#e9f2ff;border-color:#bfd4ff}
  .result{border:1px solid #e5e7eb;border-left:4px solid #3b82f6;border-radius:12px;padding:12px;background:#fff}
  .result.ok{border-left-color:#16a34a; background:#e8f5e9}
  .result.warn{border-left-color:#f59e0b; background:#fff8e1}
  .result.ng{border-left-color:#ef4444; background:#fdecea}
  .controls{display:flex;gap:10px;margin-top:10px}
  .ghost{background:#fff;border:1px dashed #ced4da}
  details.acc{border:1px solid #e5e7eb;border-radius:12px;background:#fff}
  details.acc summary{padding:12px;cursor:pointer;list-style:none}
  details.acc summary::-webkit-details-marker{display:none}
</style>
</head>
<body>
<header>
  <div class="t">ä¿®ç†å—ä»˜ã‚³ãƒ³ã‚µãƒ«ãƒŠãƒ“ï¼ˆæ–°æ½Ÿã‚¨ãƒªã‚¢ç‰ˆï¼‰</div>
  <a href="https://docs.google.com/forms/d/e/1FAIpQLSc5pwJ5ahRwDdJiZNoXA0kSZ7Y9kufFVLL2kqACfH2yQFpsEA/viewform" target="_blank" rel="noopener">æ„è¦‹ã‚’é€ã‚‹</a>
</header>
<main class="container">
  <div class="card">
    <div class="path" id="path">é€²è¡Œï¼šãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠ</div>
    <div id="content">èª­ã¿è¾¼ã¿ä¸­â€¦</div>
    <div class="controls">
      <button class="btn ghost" id="backBtn" style="display:none" type="button">â† æˆ»ã‚‹</button>
      <button class="btn primary" id="resetBtn" type="button">æœ€åˆã‹ã‚‰</button>
    </div>
  </div>
  <details class="acc card" id="historyAcc">
    <summary>ğŸ•“ æ›´æ–°å±¥æ­´ï¼ˆã‚¿ãƒƒãƒ—ã§é–‹é–‰ï¼‰</summary>
    <div id="logWrap" style="padding:0 12px 12px"></div>
  </details>
</main>

<script>
const state = { path:[], backStack:[], data:null };
const asArr = (x)=> Array.isArray(x) ? x : (x ? [String(x)] : []);
function setPath(t){ document.getElementById('path').textContent = 'é€²è¡Œï¼š' + (t||'ãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠ'); }
function clearContent(){ document.getElementById('content').innerHTML=''; }
function addButton(label, onClick){ const b=document.createElement('button'); b.className='btn'; b.type='button'; b.textContent=label; b.onclick=onClick; document.getElementById('content').appendChild(b); }
function addSectionTitle(t){ const h=document.createElement('h3'); h.textContent=t||''; document.getElementById('content').appendChild(h); }
function addResult(kind, title, details){ const d=document.createElement('div'); d.className='result '+(kind||'info'); const h=document.createElement('h3'); h.textContent=title||''; d.appendChild(h); asArr(details).forEach(x=>{ const p=document.createElement('p'); p.textContent=x; d.appendChild(p); }); document.getElementById('content').appendChild(d); }
function showBack(v){ document.getElementById('backBtn').style.display = v ? '' : 'none'; }
function push(currentRenderer, nextRenderer){ state.backStack.push({path:[...state.path],render:currentRenderer}); nextRenderer(); showBack(true); }
function goBack(){ const last=state.backStack.pop(); if(!last){ home(); return;} state.path=last.path; last.render(); setPath(state.path.join(' > ')||'ãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠ'); showBack(state.backStack.length>0); }
function getGroupOf(m){ const g=state.data.groups; for(const k in g){ if((g[k]||[]).includes(m)) return k; } return null; }

function home(){
  state.path=[]; clearContent(); setPath('ãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠ');
  const g=state.data.groups;
  const groupsUI=[ ['å›½å†…ãƒ¡ãƒ¼ã‚«ãƒ¼', g.domestic||[]], ['æµ·å¤–ãƒ¡ãƒ¼ã‚«ãƒ¼', g.overseas||[]], ['Surface', g.surface||[]], ['Apple', g.apple||[]] ];
  groupsUI.forEach(([label, list])=>{ if(!list||!list.length) return; addSectionTitle(label); list.forEach(m=> addButton(m, ()=> selectMaker(m))); });
  showBack(false);
}

function selectMaker(maker){
  push(home, ()=>{
    state.path.push('ãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠ > '+maker);
    clearContent(); setPath(state.path.join(' > '));
    const group=getGroupOf(maker);
    if(maker==='VAIO'){ viewVaio(maker); }
    else if(group==='domestic') viewDomestic(maker);
    else if(group==='overseas') viewOverseas(maker);
    else if(group==='surface') viewSurface(maker);
    else if(group==='apple') viewApple(maker);
    else addResult('ng','è¨­å®šã‚¨ãƒ©ãƒ¼',['ãƒ¡ãƒ¼ã‚«ãƒ¼ã®æ‰€å±ã‚°ãƒ«ãƒ¼ãƒ—ãŒä¸æ˜ã§ã™ã€‚data.json ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚']);
  });
}

/* --- VAIO: Sony/VAIOç¤¾ åˆ†å² â†’ VAIOç¤¾ã¯å½“ç¤¾è³¼å…¥ï¼Ÿ --- */
function viewVaio(maker){
  const t = (state.data.text && state.data.text.vaio) || {};
  const rerender = ()=>{
    clearContent(); addSectionTitle(maker); setPath(state.path.join(' > '));
    addResult('info', t.q_series || 'Sonyæ ªå¼ä¼šç¤¾ãŒè²©å£²ã—ã¦ã„ã‚‹VAIOã§ã™ã‹ï¼Ÿ ãã‚Œã¨ã‚‚ VAIOæ ªå¼ä¼šç¤¾ãŒè²©å£²ã—ã¦ã„ã‚‹VAIOã§ã™ã‹ï¼Ÿ', []);
    const hintTitle = document.createElement('h3'); hintTitle.textContent = t.hint_series_title || 'æ™‚æœŸç›®å®‰ãƒ»è£½é€ å…ƒ'; document.getElementById('content').appendChild(hintTitle);
    asArr(t.hint_series_lines).forEach(line=>{ const p=document.createElement('p'); p.style.margin='4px 0'; p.textContent=line; document.getElementById('content').appendChild(p); });

    addButton(t.l_sony || 'Sonyæ ªå¼ä¼šç¤¾ã®VAIO', ()=>{
      push(rerender, ()=>{
        state.path.push('VAIOï¼šSonyç‰ˆ');
        clearContent(); setPath(state.path.join(' > '));
        addResult('ng', t.r_sony_end_title || 'å—ä»˜çµ‚äº†ï¼ˆSonyè£½VAIOï¼‰', asArr(t.r_sony_end_details));
      });
    });

    addButton(t.l_vaio_corp || 'VAIOæ ªå¼ä¼šç¤¾ã®VAIO', ()=>{
      push(rerender, ()=>{
        state.path.push('VAIOï¼šVAIOç¤¾ç‰ˆ');
        const re2 = ()=>{
          clearContent(); setPath(state.path.join(' > '));
          addResult('info', t.q_boughtHere || 'å½“ç¤¾ã§è³¼å…¥ã•ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ', []);
          addButton('ã¯ã„', ()=>{
            push(re2, ()=>{
              state.path.push('å½“ç¤¾è³¼å…¥ï¼šã¯ã„');
              clearContent(); setPath(state.path.join(' > '));
              addResult('ok', t.r_bought_title || 'åº—èˆ—ã§ã®ä¿®ç†å—ä»˜ï¼šå¯èƒ½ï¼ˆå½“ç¤¾è³¼å…¥ï¼‰', asArr(t.r_bought_details));
            });
          });
          addButton('ã„ã„ãˆ', ()=>{
            push(re2, ()=>{
              state.path.push('å½“ç¤¾è³¼å…¥ï¼šã„ã„ãˆ');
              clearContent(); setPath(state.path.join(' > '));
              addResult('warn', t.r_not_bought_title || 'ä¿®ç†å—ä»˜ã¯å¯èƒ½ï¼ˆæ³¨æ„å–šèµ·ï¼‰', asArr(t.r_not_bought_details));
            });
          });
        };
        re2();
      });
    });
  };
  rerender();
}

/* --- å›½å†…ãƒ¡ãƒ¼ã‚«ãƒ¼ï¼ˆå…±é€šï¼‰ --- */
function viewDomestic(maker){
  const t = (state.data.text && state.data.text.domestic) || {};
  const rerender = ()=>{
    clearContent(); addSectionTitle(maker); setPath(state.path.join(' > '));
    addResult('info', t.q_hasWarranty || 'ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿è¨¼ã®æœŸé–“å†…ã§ã™ã‹ï¼Ÿ', []);
    addButton('ã¯ã„', ()=>{
      push(rerender, ()=>{
        state.path.push('ä¿è¨¼ï¼šã¯ã„');
        clearContent(); setPath(state.path.join(' > '));
        addResult('ok', t.r_warranty_title || 'ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿è¨¼å†…ã®å—ä»˜ï¼ˆæ³¨æ„äº‹é …ã‚ã‚Šï¼‰', asArr(t.r_warranty_details));
      });
    });
    addButton('ã„ã„ãˆ', ()=>{
      push(rerender, ()=>{
        state.path.push('ä¿è¨¼ï¼šã„ã„ãˆ');
        clearContent(); setPath(state.path.join(' > '));
        addResult('info', (state.data.text && state.data.text.common && state.data.text.common.q_hasNojima) || 'ãƒã‚¸ãƒã®ä¿è¨¼ã«å…¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ', []);
        addButton('ã¯ã„', ()=>{
          push(viewDomestic, ()=>{
            state.path.push('ãƒã‚¸ãƒä¿è¨¼ï¼šã¯ã„');
            clearContent(); setPath(state.path.join(' > '));
            addResult('ok', t.r_nojima_ok_title || 'åº—èˆ—ã§ã®ä¿®ç†å—ä»˜ï¼šå¯èƒ½ï¼ˆãƒã‚¸ãƒä¿è¨¼ï¼‰', asArr(t.r_nojima_ok_details));
          });
        });
        addButton('ã„ã„ãˆ', ()=>{
          push(viewDomestic, ()=>{
            state.path.push('ãƒã‚¸ãƒä¿è¨¼ï¼šã„ã„ãˆ');
            clearContent(); setPath(state.path.join(' > '));
            addResult('warn', t.r_prepay_title || 'ä¿®ç†å—ä»˜ã¯å¯èƒ½ï¼ˆå‰å—ã‘é‡‘ã‚ã‚Šï¼‰', asArr(t.r_prepay_details));
          });
        });
      });
    });
  };
  rerender();
}

/* --- æµ·å¤–ãƒ¡ãƒ¼ã‚«ãƒ¼ï¼ˆå…±é€šï¼‰ --- */
function viewOverseas(maker){
  const t = (state.data.text && state.data.text.overseas) || {};
  const rerender = ()=>{
    clearContent(); addSectionTitle(maker); setPath(state.path.join(' > '));
    addResult('info', t.q_hasWarranty || 'ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿è¨¼ã®æœŸé–“å†…ã§ã™ã‹ï¼Ÿ', []);
    addButton('ã¯ã„', ()=>{
      push(rerender, ()=>{
        state.path.push('ä¿è¨¼ï¼šã¯ã„');
        clearContent(); setPath(state.path.join(' > '));
        const nojimaQ = (state.data.text && state.data.text.common && state.data.text.common.q_hasNojima) || 'ãƒã‚¸ãƒã®ä¿è¨¼ã«å…¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ';
        addResult('info', nojimaQ, []);
        addButton('ã¯ã„', ()=>{
          push(viewOverseas, ()=>{
            state.path.push('ãƒã‚¸ãƒä¿è¨¼ï¼šã¯ã„');
            clearContent(); setPath(state.path.join(' > '));
            const merged = asArr(t.r_store_ok_details).concat(asArr(t.r_warranty_details));
            addResult('ok', t.r_store_ok_title || 'åº—èˆ—ã§ã®ä¿®ç†å—ä»˜ï¼šå¯¾å¿œå¯èƒ½', merged);
          });
        });
        addButton('ã„ã„ãˆ', ()=>{
          push(viewOverseas, ()=>{
            state.path.push('ãƒã‚¸ãƒä¿è¨¼ï¼šã„ã„ãˆ');
            clearContent(); setPath(state.path.join(' > '));
            addResult('warn', t.r_warn_title || 'ä¿®ç†å—ä»˜å¯èƒ½ï¼ˆã”èª¬æ˜ã®ãŠé¡˜ã„ï¼‰', asArr(t.r_warn_details));
          });
        });
      });
    });
    addButton('ã„ã„ãˆ', ()=>{
      push(rerender, ()=>{
        state.path.push('ä¿è¨¼ï¼šã„ã„ãˆ');
        clearContent(); setPath(state.path.join(' > '));
        addResult('warn', t.r_warn_title || 'ä¿®ç†å—ä»˜å¯èƒ½ï¼ˆã”èª¬æ˜ã®ãŠé¡˜ã„ï¼‰', asArr(t.r_warn_details));
      });
    });
  };
  rerender();
}

/* --- Surface --- */
function viewSurface(maker){
  const t = (state.data.text && state.data.text.surface) || {};
  clearContent(); addSectionTitle(maker); setPath(state.path.join(' > '));
  addResult('ng', t.r_title || 'åº—èˆ—ä¿®ç†å—ä»˜ä¸å¯', asArr(t.r_details));
}

/* --- Apple --- */
function viewApple(maker){
  const t = (state.data.text && state.data.text.apple) || {};
  const rerender=()=>{
    clearContent(); addSectionTitle(maker); setPath(state.path.join(' > '));
    addResult('info', t.q_hasWarranty || 'ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿è¨¼ã®æœŸé–“å†…ã§ã™ã‹ï¼Ÿ', []);
    addButton('ã¯ã„', ()=>{
      push(rerender, ()=>{
        state.path.push('ä¿è¨¼ï¼šã¯ã„');
        clearContent(); setPath(state.path.join(' > '));
        addResult('ng', t.r_direct_title || 'åº—é ­å—ä»˜ä¸å¯ï¼ˆAppleã¸ç›´æ¥æ¡ˆå†…ï¼‰', asArr(t.r_direct_details));
      });
    });
    addButton('ã„ã„ãˆ', ()=>{
      push(rerender, ()=>{
        state.path.push('ä¿è¨¼ï¼šã„ã„ãˆ');
        clearContent(); setPath(state.path.join(' > '));
        addResult('info', t.q_nojima_type || 'ãƒã‚¸ãƒä¿è¨¼ã®ã”åŠ å…¥çŠ¶æ³ã‚’é¸æŠã—ã¦ãã ã•ã„', []);
        addButton(t.l_ultimate || 'â‘  ã‚¢ãƒ«ãƒ†ã‚£ãƒ¡ãƒƒãƒˆä¿è¨¼ã«åŠ å…¥ã—ã¦ã„ã‚‹', ()=>{
          push(viewApple, ()=>{
            state.path.push('ã‚¢ãƒ«ãƒ†ã‚£ãƒ¡ãƒƒãƒˆ');
            clearContent(); setPath(state.path.join(' > '));
            addResult('ok', t.r_ultimate_title || 'åº—èˆ—ã§ã®å•†å“äº¤æ›ãƒ»ãƒã‚¤ãƒ³ãƒˆãƒãƒƒã‚¯å¯¾å¿œï¼ˆã‚¢ãƒ«ãƒ†ã‚£ãƒ¡ãƒƒãƒˆä¿è¨¼ï¼‰', asArr(t.r_ultimate_details));
          });
        });
        addButton(t.l_premium_plus || 'â‘¡ ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä¿è¨¼ãƒ—ãƒ©ã‚¹ã«åŠ å…¥ã—ã¦ã„ã‚‹', ()=>{
          push(viewApple, ()=>{
            state.path.push('ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä¿è¨¼ãƒ—ãƒ©ã‚¹');
            clearContent(); setPath(state.path.join(' > '));
            addResult('info', t.q_after_date || '2023å¹´6æœˆ1æ—¥ä»¥é™ã«è³¼å…¥ã•ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ', []);
            addButton('ã¯ã„', ()=>{
              push(viewApple, ()=>{
                state.path.push('2023/6/1ä»¥é™');
                clearContent(); setPath(state.path.join(' > '));
                addResult('warn', t.r_pp_after_title || 'ãƒã‚¤ãƒ³ãƒˆãƒãƒƒã‚¯å¯¾å¿œï¼ˆ2023/6/1 ä»¥é™è³¼å…¥ï¼‰', asArr(t.r_pp_after_details));
              });
            });
            addButton('ã„ã„ãˆ', ()=>{
              push(viewApple, ()=>{
                state.path.push('2023/6/1ä»¥å‰');
                clearContent(); setPath(state.path.join(' > '));
                addResult('ok', t.r_pp_before_title || 'é€šå¸¸å—ä»˜ â†’ ã‚¦ãƒãƒ€ã‚¨ã‚¹ã‚³ã§ä¿®ç†', asArr(t.r_pp_before_details));
              });
            });
          });
        });
        addButton(t.l_no_contract || 'â‘¢ ä¿è¨¼ã«å…¥ã£ã¦ã„ãªã„', ()=>{
          push(viewApple, ()=>{
            state.path.push('æœªåŠ å…¥');
            clearContent(); setPath(state.path.join(' > '));
            addResult('ng', t.r_no_contract_title || 'Appleã§ã®ç›´æ¥ä¿®ç†ã‚’ã”æ¡ˆå†…ï¼ˆæœªåŠ å…¥ï¼‰', asArr(t.r_no_contract_details));
          });
        });
      });
    });
  };
  rerender();
}

async function loadUpdateLog(){
  const wrap=document.getElementById('logWrap'); wrap.textContent='èª­ã¿è¾¼ã¿ä¸­â€¦';
  try{
    const r=await fetch('update_log.json',{cache:'no-store'}); if(!r.ok) throw 0;
    const logs=await r.json(); wrap.innerHTML='';
    if(!Array.isArray(logs)||logs.length===0){ wrap.textContent='å±¥æ­´ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚'; return; }
    logs.forEach(item=>{
      const d=document.createElement('details'); d.className='acc';
      const s=document.createElement('summary');
      s.textContent = `${item.date||''}ï½œ${item.store||''}ï½œ${item.name||''}ï½œ${item.content||''}`;
      const b=document.createElement('div'); b.style.padding='0 12px 12px'; b.textContent = item.content || '';
      d.appendChild(s); d.appendChild(b); wrap.appendChild(d);
    });
  }catch(e){ wrap.textContent='update_log.json ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼ˆå¿…è¦ã«å¿œã˜ã¦è¨­ç½®ã—ã¦ãã ã•ã„ï¼‰ã€‚'; }
}

async function init(){
  document.getElementById('resetBtn').onclick=()=>{ state.backStack=[]; home(); };
  document.getElementById('backBtn').onclick=goBack;
  document.getElementById('historyAcc').addEventListener('toggle',e=>{ if(e.target.open) loadUpdateLog(); });
  try{
    const r=await fetch('data.json',{cache:'no-store'}); if(!r.ok) throw 0;
    state.data=await r.json(); home();
  }catch(e){
    document.getElementById('content').innerHTML='<p style="color:#b91c1c">è¨­å®šã‚¨ãƒ©ãƒ¼ï¼šdata.json ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚</p>';
  }
}
init();
</script>
</body>
</html>
