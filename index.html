<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ä¿®ç†å—ä»˜ã‚³ãƒ³ã‚µãƒ«ãƒŠãƒ“ï¼ˆæ–°æ½Ÿã‚¨ãƒªã‚¢ç‰ˆï¼‰</title>
<style>
  :root{
    --c-bg:#f6f8fb;
    --c-card:#ffffff;
    --c-accent:#1a56db;
    --c-text:#0f172a;
    --c-muted:#64748b;
    --c-green:#e7f6ec;
    --c-yellow:#fff7e6;
    --c-red:#ffecec;
    --radius:12px;
  }
  html,body{margin:0;padding:0;background:var(--c-bg);color:var(--c-text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";}
  header{background:#0b2a6b;color:#fff;padding:16px 20px;display:flex;align-items:center;justify-content:space-between;}
  header h1{margin:0;font-size:20px;letter-spacing:.04em}
  header .right a{display:inline-flex;gap:8px;align-items:center;background:#2155d6;color:#fff;text-decoration:none;padding:10px 14px;border-radius:999px;font-weight:600}
  main{max-width:960px;margin:16px auto;padding:0 12px}
  .card{background:var(--c-card);border-radius:var(--radius);box-shadow:0 6px 20px rgba(15,23,42,.06);padding:16px;margin-bottom:16px}
  .h2{font-size:20px;font-weight:800;margin:4px 0 12px}
  .btn{background:var(--c-accent);color:#fff;border:0;border-radius:999px;padding:10px 14px;font-weight:700;cursor:pointer}
  .btn.secondary{background:#e8eefc;color:#1a56db}
  .grid{display:flex;flex-wrap:wrap;gap:12px}
  .pill{background:#e8eefc;border:1px solid #d6e3ff;color:#1a56db;border-radius:999px;padding:10px 16px;font-weight:700;cursor:pointer}
  .muted{color:var(--c-muted);font-size:14px}
  .result{border-radius:12px;padding:14px 16px;margin:14px 0;display:flex;gap:10px;align-items:flex-start}
  .result.green{background:var(--c-green)}
  .result.yellow{background:var(--c-yellow)}
  .result.red{background:var(--c-red)}
  .sig{font-size:20px;line-height:1.1;margin-top:2px}
  .title{font-weight:900;margin:0 0 4px}
  .backline{display:flex;gap:8px;align-items:center;margin-bottom:10px}
  .backbtn{background:#eef2ff;border:1px solid #c7d2fe;color:#1d4ed8;border-radius:999px;padding:8px 12px;font-weight:700;cursor:pointer}
  .hidden{display:none}
  details.ac{background:var(--c-card);border-radius:var(--radius);box-shadow:0 6px 20px rgba(15,23,42,.06);padding:8px}
  details.ac summary{list-style:none;cursor:pointer;padding:10px 10px;border-radius:10px;font-weight:800}
  details.ac[open] summary{background:#f2f6ff}
  table{border-collapse:collapse;width:100%}
  td,th{border-bottom:1px solid #e5e7eb;padding:10px;text-align:left}
</style>
</head>
<body>
<header>
  <h1>ä¿®ç†å—ä»˜ã‚³ãƒ³ã‚µãƒ«ãƒŠãƒ“ï¼ˆæ–°æ½Ÿã‚¨ãƒªã‚¢ç‰ˆï¼‰</h1>
  <div class="right">
    <a href="https://docs.google.com/forms/d/e/1FAIpQLSc5pwJ5ahRwDdJiZNoXA0kSZ7Y9kufFVLL2kqACfH2yQFpsEA/viewform" target="_blank" rel="noopener">ğŸ’¬ æ„è¦‹ã‚’é€ã‚‹</a>
  </div>
</header>
<main>
  <div id="stage" class="card"></div>

  <details class="ac">
    <summary>ğŸ•’ æ›´æ–°å±¥æ­´ï¼ˆã‚¿ãƒƒãƒ—ã§é–‹é–‰ï¼‰</summary>
    <div id="history" style="padding:4px 10px 14px"></div>
  </details>
</main>

<script>
const S = document.getElementById('stage');
const H = document.getElementById('history');

let DATA = null;
let UPDATES = null;
const navStack = []; // ç”»é¢é·ç§»ã®å±¥æ­´

async function loadJSON(url, fallback){
  try{
    const res = await fetch(url, {cache:'no-store'});
    if(!res.ok) throw new Error(res.status);
    return await res.json();
  }catch(e){
    return fallback ?? null;
  }
}

function topView(){
  navStack.length = 0; // å±¥æ­´ãƒªã‚»ãƒƒãƒˆ
  S.innerHTML = `
    <div class="h2">ãƒ¡ãƒ¼ã‚«ãƒ¼åŒºåˆ†ã‚’é¸æŠ</div>
    <div class="grid" style="margin-top:8px">
      <button class="pill" data-g="domestic">domestic</button>
      <button class="pill" data-g="overseas">overseas</button>
      <button class="pill" data-g="surface">surface</button>
      <button class="pill" data-g="apple">apple</button>
    </div>
  `;
  S.querySelectorAll('.pill').forEach(b=>b.addEventListener('click',()=>{
    const g = b.dataset.g;
    if(g==='surface'){ return surfaceImmediate(); }
    showMakers(g);
  }));
}

function renderBackLine(){
  const line = document.createElement('div');
  line.className = 'backline';
  const back = document.createElement('button');
  back.className = 'backbtn';
  back.textContent = 'â† 1ã¤å‰ã«æˆ»ã‚‹';
  back.onclick = ()=>{
    if(navStack.length){
      const prev = navStack.pop();
      prev();
    }else{
      topView();
    }
  };
  line.appendChild(back);
  return line;
}

function showMakers(groupKey){
  const makers = DATA.groups[groupKey] || [];
  const titleMap = {domestic:'å›½å†…ãƒ¡ãƒ¼ã‚«ãƒ¼', overseas:'æµ·å¤–ãƒ¡ãƒ¼ã‚«ãƒ¼', surface:'Surface', apple:'Apple'};
  const backTo = ()=>topView();
  navStack.push(backTo);

  S.innerHTML = '';
  S.appendChild(renderBackLine());
  const wrap = document.createElement('div');
  wrap.className = 'card';
  wrap.innerHTML = `<div class="h2">${titleMap[groupKey]} ä¸€è¦§</div>`;
  const grid = document.createElement('div');
  grid.className = 'grid';
  makers.forEach(name=>{
    const btn = document.createElement('button');
    btn.className = 'pill';
    btn.textContent = name;
    btn.onclick = ()=>{
      showFirstQuestion(groupKey, name);
    };
    grid.appendChild(btn);
  });
  wrap.appendChild(grid);
  S.appendChild(wrap);
}

function signalCard(kind, title, lines){
  const map = {
    ok:{cls:'green', icon:'ğŸŸ¢'},
    warn:{cls:'yellow', icon:'ğŸŸ¡'},
    ng:{cls:'red', icon:'ğŸ”´'}
  };
  const info = map[kind] || map.warn;
  const div = document.createElement('div');
  div.className = `result ${info.cls}`;
  div.innerHTML = `
    <div class="sig">${info.icon}</div>
    <div>
      <div class="title">${title}</div>
      <div class="muted">${(lines||[]).map(x=>escapeHtml(x)).join('<br>')}</div>
    </div>`;
  return div;
}
function escapeHtml(s){ return String(s).replace(/[&<>"]/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;" }[m])); }

function showFirstQuestion(groupKey, makerName){
  // Surfaceã¯ã“ã“ã«æ¥ãªã„ï¼ˆsurfaceImmediateã§å‡¦ç†ï¼‰
  const backTo = ()=>showMakers(groupKey);
  navStack.push(backTo);

  S.innerHTML = '';
  S.appendChild(renderBackLine());

  const card = document.createElement('div');
  card.className = 'card';
  const qLabel = (groupKey==='apple' ? DATA.text.apple.q_hasWarranty
                                     : DATA.text[groupKey]?.q_hasWarranty || 'ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿è¨¼ã®æœŸé–“å†…ã§ã™ã‹ï¼Ÿ');
  card.innerHTML = `
    <div class="h2">${makerName} - ${escapeHtml(qLabel)}</div>
    <div class="grid" style="margin-top:6px">
      <button class="btn" id="yesBtn">ã¯ã„</button>
      <button class="btn secondary" id="noBtn">ã„ã„ãˆ</button>
      <button class="btn secondary" id="backMakers">æˆ»ã‚‹ï¼ˆãƒ¡ãƒ¼ã‚«ãƒ¼ä¸€è¦§ï¼‰</button>
    </div>
    <div id="resultBox"></div>
  `;
  S.appendChild(card);

  document.getElementById('backMakers').onclick = ()=>{
    navStack.pop(); // ç¾åœ¨ã®ç”»é¢ã‚’å±¥æ­´ã‹ã‚‰å‰Šé™¤
    showMakers(groupKey);
  };

  const resultBox = card.querySelector('#resultBox');

  // apple ã ã‘åˆ†å²ãŒç‰¹æ®Šã€‚ãã®ä»–ã¯å…±é€š
  const onYes = ()=>{
    resultBox.innerHTML='';
    if(groupKey==='apple'){
      // Apple: ä¿è¨¼ã‚ã‚Š â†’ ç›´æ¥æ¡ˆå†…
      resultBox.appendChild( signalCard('ng', DATA.text.apple.r_direct_title, DATA.text.apple.r_direct_details.concat(["Appleã‚µãƒ¼ãƒ“ã‚¹&ã‚µãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ³ã€€0120-277-535 ã¸ã®ã”é€£çµ¡ã‚’ãŠå®¢æ§˜ã«ãŠä¼ãˆãã ã•ã„ã€‚"])) );
      // æ¬¡ã®ãƒã‚¸ãƒä¿è¨¼åˆ†å²
      const next = document.createElement('div');
      next.style.marginTop = '8px';
      next.innerHTML = `
        <div class="h2" style="font-size:16px">ãƒã‚¸ãƒä¿è¨¼ã®ã”åŠ å…¥çŠ¶æ³ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
        <div class="grid">
          <button class="pill" id="aUlt">${escapeHtml(DATA.text.apple.l_ultimate)}</button>
          <button class="pill" id="aPre">${escapeHtml(DATA.text.apple.l_premium_plus)}</button>
          <button class="pill" id="aNone">${escapeHtml(DATA.text.apple.l_no_contract)}</button>
        </div>`;
      resultBox.appendChild(next);
      next.querySelector('#aUlt').onclick = ()=>{
        resultBox.innerHTML='';
        resultBox.appendChild( signalCard('ok', DATA.text.apple.r_ultimate_title, DATA.text.apple.r_ultimate_details) );
      };
      next.querySelector('#aPre').onclick = ()=>{
        resultBox.innerHTML='';
        // 2023/6/1 ä»¥é™ã‹ï¼Ÿ
        const ask = document.createElement('div');
        ask.innerHTML = `
          <div class="h2" style="font-size:16px">${escapeHtml(DATA.text.apple.q_after_date)}</div>
          <div class="grid" style="margin-top:6px">
            <button class="btn" id="afterYes">ã¯ã„</button>
            <button class="btn secondary" id="afterNo">ã„ã„ãˆ</button>
          </div>`;
        resultBox.appendChild(ask);
        ask.querySelector('#afterYes').onclick = ()=>{
          resultBox.innerHTML='';
          resultBox.appendChild( signalCard('warn', DATA.text.apple.r_uchi_title, DATA.text.apple.r_uchi_details.concat(["Appleç”¨ã®è£½å“ä¿®ç†ç”³è¾¼æ›¸ã‚’è¨˜è¼‰ã®ä¸Šã€ä¿®ç†å—ä»˜ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚ãƒã‚¤ãƒ³ãƒˆãƒãƒƒã‚¯ã§ã®å¯¾å¿œã«ãªã‚Šã¾ã™ã€‚è‡ªç„¶æ•…éšœãƒ»ç‰©æã®å ´åˆã§ãƒ•ãƒ­ãƒ¼ãŒå¤‰ã‚ã‚‹ã®ã§ã€è©³ã—ãã¯MDç­‰ã¸ã®ç¢ºèªã‚’è¡Œã£ã¦ãã ã•ã„ã€‚"])) );
        };
        ask.querySelector('#afterNo').onclick = ()=>{
          resultBox.innerHTML='';
          resultBox.appendChild( signalCard('ok', DATA.text.apple.r_pre_title, DATA.text.apple.r_pre_details) );
          // æ–‡æœ«è¿½è¨˜ï¼ˆè¦æœ›ï¼‰
          const extra = document.createElement('div');
          extra.className='muted';
          extra.style.marginTop='6px';
          extra.textContent = 'â€» Appleè£½å“ä¿®ç†ç”³è¾¼æ›¸ã¯ãƒ‡ã‚¹ã‚¯ãƒãƒƒãƒ„ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡ºæ¥ã¾ã™';
          resultBox.appendChild(extra);
        };
      };
      next.querySelector('#aNone').onclick = ()=>{
        resultBox.innerHTML='';
        resultBox.appendChild( signalCard('ng', DATA.text.apple.r_direct2_title, DATA.text.apple.r_direct2_details.concat(["Appleã‚µãƒ¼ãƒ“ã‚¹&ã‚µãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ³ã€€0120-277-535 ã¸ã®ã”é€£çµ¡ã‚’ãŠå®¢æ§˜ã«ãŠä¼ãˆãã ã•ã„ã€‚"])) );
      };
      return;
    }

    // domestic / overseas ï¼ˆä¿è¨¼ã‚ã‚Šï¼‰
    if(groupKey==='domestic'){
      resultBox.appendChild( signalCard('ok', DATA.text.domestic.r_warranty_title, DATA.text.domestic.r_warranty_details) );
    }else if(groupKey==='overseas'){
      // ä¿è¨¼ã‚ã‚Š â†’ æ³¨æ„å–šèµ·ï¼†ãƒã‚¸ãƒä¿è¨¼ç¢ºèª
      resultBox.appendChild( signalCard('warn', DATA.text.overseas.r_warn_title, DATA.text.overseas.r_warn_details.concat(["ç—‡çŠ¶æœªå†ç¾ã‚„ãŠå®¢æ§˜éƒ½åˆã®ä¿®ç†ä¸­æ­¢æ™‚ã¯è¦‹ç©ã‚Šä»£ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚"])) );
      // ãƒã‚¸ãƒä¿è¨¼ï¼Ÿ
      const n = document.createElement('div');
      n.innerHTML = `
        <div class="h2" style="font-size:16px">${escapeHtml(DATA.text.common.q_hasNojima)}</div>
        <div class="grid">
          <button class="btn" id="njYes">ã¯ã„</button>
          <button class="btn secondary" id="njNo">ã„ã„ãˆ</button>
        </div>`;
      resultBox.appendChild(n);
      n.querySelector('#njYes').onclick = ()=>{
        resultBox.innerHTML='';
        resultBox.appendChild( signalCard('ok', DATA.text.overseas.r_store_ok_title, DATA.text.overseas.r_store_ok_details) );
      };
      n.querySelector('#njNo').onclick = ()=>{
        resultBox.innerHTML='';
        resultBox.appendChild( signalCard('warn', DATA.text.overseas.r_warn_title, DATA.text.overseas.r_warn_details) );
      };
    }
  };

  const onNo = ()=>{
    resultBox.innerHTML='';
    if(groupKey==='domestic'){
      // ãƒã‚¸ãƒä¿è¨¼ï¼Ÿ
      const n = document.createElement('div');
      n.innerHTML = `
        <div class="h2" style="font-size:16px">${escapeHtml(DATA.text.common.q_hasNojima)}</div>
        <div class="grid">
          <button class="btn" id="njYes">ã¯ã„</button>
          <button class="btn secondary" id="njNo">ã„ã„ãˆ</button>
        </div>`;
      resultBox.appendChild(n);
      n.querySelector('#njYes').onclick = ()=>{
        resultBox.innerHTML='';
        resultBox.appendChild( signalCard('ok', DATA.text.domestic.r_nojima_ok_title, DATA.text.domestic.r_nojima_ok_details) );
      };
      n.querySelector('#njNo').onclick = ()=>{
        resultBox.innerHTML='';
        resultBox.appendChild( signalCard('warn', DATA.text.domestic.r_prepay_title, DATA.text.domestic.r_prepay_details.concat(["ä¿®ç†ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã€ãƒ¡ãƒ¼ã‚«ãƒ¼å´ã§å‰å—é‡‘ã‚’è¶…ãˆã‚‹è¦‹ç©ã‚‚ã‚Šè²»ãŒç™ºç”Ÿã—ã¦ã‚‚ã€ä»•å…¥ã‚Œå—ã‘å…¥ã‚Œæ™‚ã«é‡‘é¡5,500å††ã¸ä¿®æ­£OKã€‚"])) );
      };
    }else if(groupKey==='overseas'){
      resultBox.appendChild( signalCard('warn', DATA.text.overseas.r_warn_title, [
        "ãƒã‚¸ãƒã§ã®ä¿®ç†å—ä»˜ãŒå¯èƒ½ã§ã™ã€‚",
        "ãŸã ã—ä¸‡ãŒä¸€æœ‰å„Ÿä¿®ç†ã®å ´åˆã€ãŠå®¢æ§˜ãŒãƒ¡ãƒ¼ã‚«ãƒ¼ã«ç›´æ¥ä¾é ¼ã™ã‚‹ã‚ˆã‚Šé«˜é¡ã«ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ã”èª¬æ˜ã®ä¸Šã€åˆ¤æ–­ã‚’å°Šé‡ã—ã¦ãã ã•ã„ã€‚"
      ]) );
    }else if(groupKey==='apple'){
      // ä¿è¨¼ãªã— â†’ ç›´æ¥æ¡ˆå†…
      resultBox.appendChild( signalCard('ng', DATA.text.apple.r_direct2_title, DATA.text.apple.r_direct2_details.concat(["Appleã‚µãƒ¼ãƒ“ã‚¹&ã‚µãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ³ã€€0120-277-535 ã¸ã®ã”é€£çµ¡ã‚’ãŠå®¢æ§˜ã«ãŠä¼ãˆãã ã•ã„ã€‚"])) );
    }
  };

  document.getElementById('yesBtn').onclick = onYes;
  document.getElementById('noBtn').onclick  = onNo;
}

function surfaceImmediate(){
  const groupKey='surface';
  const backTo = ()=>topView();
  navStack.push(backTo);

  S.innerHTML='';
  S.appendChild(renderBackLine());

  const card = document.createElement('div');
  card.className='card';
  card.innerHTML = `<div class="h2">Microsoft Surface</div><div id="resultBox"></div>`;
  S.appendChild(card);
  const resultBox = card.querySelector('#resultBox');
  // ç›´æ¥çµæœï¼ˆã¯ã„/ã„ã„ãˆã‚’å‡ºã•ãªã„ï¼‰
  const t = DATA.text.surface.r_title;
  const d = DATA.text.surface.r_details.concat(["ãƒã‚¤ã‚¯ãƒ­ã‚½ãƒ•ãƒˆã‚µãƒãƒ¼ãƒˆã‚»ãƒ³ã‚¿ãƒ¼ï¼ˆSurfaceå°‚ç”¨ï¼‰ é›»è©±ç•ªå·ï¼š0120-54-2244ï¼ˆå—ä»˜ï¼šæœˆã€œé‡‘ 9:00ã€œ18:00ï¼‰"]);
  resultBox.appendChild( signalCard('ng', t, d) );
}

function renderHistory(){
  if(!Array.isArray(UPDATES)) return;
  const rows = UPDATES.map(u=>{
    return `<tr><td>${escapeHtml(u.date||'')}</td><td>${escapeHtml(u.store||'')}</td><td>${escapeHtml(u.person||'')}</td><td>${escapeHtml(u.note||'')}</td></tr>`;
  }).join('');
  H.innerHTML = `
    <table>
      <thead><tr><th>æ—¥ä»˜</th><th>åº—èˆ—</th><th>æ‹…å½“</th><th>æ›´æ–°å†…å®¹</th></tr></thead>
      <tbody>${rows}</tbody>
    </table>`;
}

async function boot(){
  DATA = await loadJSON('data.json', null);
  UPDATES = await loadJSON('update_log.json', []);
  renderHistory();
  topView();
}

boot();
</script>
</body>
</html>
