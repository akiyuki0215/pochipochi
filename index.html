<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ä¿®ç†å—ä»˜ã‚³ãƒ³ã‚µãƒ«ãƒŠãƒ“ï¼ˆæ–°æ½Ÿã‚¨ãƒªã‚¢ç‰ˆï¼‰</title>
  <style>
    :root{
      --bg:#f7f9fc; --panel:#ffffff; --ink:#0b1220; --muted:#6b7280;
      --brand:#0b6bcb; --brand-ink:#ffffff; --ok:#e9f9ef; --warn:#fff9e6; --ng:#feeeee;
      --ring: rgba(11,107,203,.25); --chip:#eef2f7;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP","Yu Gothic UI","Yu Gothic",Meiryo,sans-serif;color:var(--ink);background:var(--bg)}
    .container{max-width:980px;margin:0 auto;padding:16px}
    header{background:linear-gradient(90deg,#0b6bcb,#0f2b6a);color:#fff;position:sticky;top:0;z-index:10}
    header .bar{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:14px 16px}
    .title{font-weight:700;letter-spacing:.03em}.sub{font-size:12px;opacity:.9}
    .btn{appearance:none;border:0;border-radius:10px;padding:10px 14px;font-weight:600;background:#f1f5f9;color:#0b2b4a;cursor:pointer;transition:.15s;box-shadow:0 1px 0 rgba(0,0,0,.02), inset 0 0 0 1px #e5e7eb}
    .btn:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(0,0,0,.08), inset 0 0 0 1px #dbe0e6}
    .btn.brand{background:var(--brand);color:var(--brand-ink);box-shadow:none}
    .card{background:var(--panel);border-radius:14px;box-shadow:0 1px 0 rgba(0,0,0,.04),0 10px 30px rgba(2,13,40,.06);padding:14px 16px;margin:14px 0}
    .section-title{font-size:18px;font-weight:700;margin:10px 0 6px}
    .chip{display:inline-flex;align-items:center;gap:8px;background:var(--chip);border-radius:999px;padding:8px 12px;margin:6px 8px 6px 0;cursor:pointer;border:1px solid #e6ebf2}
    .chip:focus,.chip:active{outline:none;box-shadow:0 0 0 4px var(--ring)}
    .result{border-left:6px solid #d1e3ff;padding:10px 12px;border-radius:12px;margin:10px 0;background:var(--warn)}
    .result.ok{background:var(--ok);border-left-color:#22c55e}
    .result.warn{background:var(--warn);border-left-color:#f59e0b}
    .result.ng{background:var(--ng);border-left-color:#ef4444}
    .result h3{margin:0 0 6px;font-size:18px}.result p{margin:6px 0;line-height:1.7}
    .muted{color:var(--muted)} .row{display:flex;gap:8px;flex-wrap:wrap}
    .breadcrumb{font-size:12px;color:var(--muted);margin:6px 0 0}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    details.acd{background:var(--panel);border-radius:14px;box-shadow:0 1px 0 rgba(0,0,0,.04),0 8px 24px rgba(2,13,40,.06);padding:8px}
    details.acd > summary{list-style:none;cursor:pointer;padding:10px 12px;border-radius:12px;display:flex;gap:10px;align-items:center}
    details.acd > summary::marker, details.acd > summary::-webkit-details-marker{display:none}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{padding:10px;border-bottom:1px solid #eef2f7;text-align:left;font-size:14px}
    .table th{color:var(--muted);font-weight:600}
  </style>
</head>
<body>
  <header>
    <div class="bar container">
      <div>
        <div class="title">ä¿®ç†å—ä»˜ã‚³ãƒ³ã‚µãƒ«ãƒŠãƒ“ï¼ˆæ–°æ½Ÿã‚¨ãƒªã‚¢ç‰ˆï¼‰</div>
        <div class="sub">ãƒ¡ãƒ¼ã‚«ãƒ¼ãƒ»ä¿è¨¼ã®ãƒŠãƒ¬ãƒƒã‚¸ã‚’JSONã§ç®¡ç†ã—ã€èª°ã§ã‚‚åŒã˜åˆ¤æ–­ã‚’</div>
      </div>
      <a class="btn brand" href="https://docs.google.com/forms/d/e/1FAIpQLSc5pwJ5ahRwDdJiZNoXA0kSZ7Y9kufFVLL2kqACfH2yQFpsEA/viewform" target="_blank" rel="noopener">æ„è¦‹ã‚’é€ã‚‹ï¼ˆGoogleãƒ•ã‚©ãƒ¼ãƒ ï¼‰</a>
    </div>
  </header>

  <main class="container">
    <div id="crumb" class="breadcrumb">é€²è¡Œï¼šãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠ</div>
    <section class="card" id="panel"></section>

    <details class="acd" id="history" open>
      <summary>ğŸ•™ æ›´æ–°å±¥æ­´ï¼ˆã‚¿ãƒƒãƒ—ã§é–‹é–‰ï¼‰</summary>
      <div class="card" id="historyBody">
        <div class="muted" style="margin-bottom:6px">â€» å±¥æ­´ã¯ <span style="font-family:ui-monospace">update_log.json</span> ã‚’èª­ã¿è¾¼ã¿è¡¨ç¤ºã—ã¾ã™ã€‚ï¼ˆåˆå›ã®ã¿è¡¨ç¤ºï¼‰</div>
        <table class="table" id="historyTable">
          <thead><tr><th>æ—¥ä»˜</th><th>åº—èˆ—å</th><th>åå‰</th><th>æ›´æ–°å†…å®¹</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </details>

    <div class="controls">
      <button class="btn" id="backBtn">â† æˆ»ã‚‹</button>
      <button class="btn" id="homeBtn">æœ€åˆã‹ã‚‰</button>
    </div>
  </main>

  <script type="module">
    import { ui, app } from './core.js';
    import { renderApple } from './vendor_apple.js';
    import { renderVAIO } from './vendor_vaio.js';
    import { renderDomestic, renderSurface } from './vendor_domestic.js';
    import { renderOverseas } from './vendor_overseas.js';

    // ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
    function render(screen, arg){
      switch(screen){
        case "home": return showHome();
        case "domestic": return renderDomestic(arg);
        case "overseas": return renderOverseas(arg);
        case "surface":  return renderSurface();
        case "apple":    return renderApple();
        case "vaio":     return renderVAIO();
      }
    }

    ui.backBtn.onclick = ()=> ui.goBack(render);
    ui.homeBtn.onclick = ()=> { ui.goHome(render); };

    // ãƒ›ãƒ¼ãƒ 
    function showHome(){
      ui.clear();
      ui.resetCrumb();

      const g = app.DATA?.groups||{};
      const sec = document.createElement("div");

      if(g.domestic?.length){
        sec.append(childTitle("å›½å†…ãƒ¡ãƒ¼ã‚«ãƒ¼"));
        const row=document.createElement("div"); row.className="row";
        g.domestic.forEach(m=>{
          const b=document.createElement("button"); b.className="chip"; b.textContent=m;
          b.onclick=()=>{ ui.pushView("domestic",[m]); ui.pushCrumb(m); render("domestic", m); };
          row.append(b);
        });
        sec.append(row);
      }

      if(g.overseas?.length){
        sec.append(childTitle("æµ·å¤–ãƒ¡ãƒ¼ã‚«ãƒ¼"));
        const row=document.createElement("div"); row.className="row";
        g.overseas.forEach(m=>{
          const b=document.createElement("button"); b.className="chip"; b.textContent=m;
          b.onclick=()=>{ ui.pushView("overseas",[m]); ui.pushCrumb(m); render("overseas", m); };
          row.append(b);
        });
        sec.append(row);
      }

      if(g.surface?.length){
        sec.append(childTitle("Surface"));
        const row=document.createElement("div"); row.className="row";
        g.surface.forEach(_=>{
          const b=document.createElement("button"); b.className="chip"; b.textContent="Surface";
          b.onclick=()=>{ ui.pushView("surface",[]); ui.pushCrumb("Surface"); render("surface"); };
          row.append(b);
        });
        sec.append(row);
      }

      if(g.apple?.length){
        sec.append(childTitle("Apple"));
        const row=document.createElement("div"); row.className="row";
        g.apple.forEach(_=>{
          const b=document.createElement("button"); b.className="chip"; b.textContent="Apple";
          b.onclick=()=>{ ui.pushView("apple",[]); ui.pushCrumb("Apple"); render("apple"); };
          row.append(b);
        });
        sec.append(row);
      }

      // VAIOã¯å›½å†…ã«ã‚‚å«ã¾ã‚Œã‚‹ãŒã€ç‰¹åˆ¥å°ç·šã‚‚æ®‹ã™å ´åˆã¯ä»¥ä¸‹ã‚’æ´»ã‹ã™ï¼ˆä»»æ„ï¼‰
      // sec.append(childTitle("ç‰¹åˆ¥ãƒ¡ãƒ‹ãƒ¥ãƒ¼"));
      // const rowX=document.createElement("div"); rowX.className="row";
      // const vaioBtn=document.createElement("button"); vaioBtn.className="chip"; vaioBtn.textContent="VAIOï¼ˆç‰¹åˆ¥ãƒ•ãƒ­ãƒ¼ï¼‰";
      // vaioBtn.onclick=()=>{ ui.pushView("vaio",[]); ui.pushCrumb("VAIO"); render("vaio"); };
      // rowX.append(vaioBtn); sec.append(rowX);

      ui.panel.append(sec);
      ui.renderHistoryOnce(); // åˆå›ã®ã¿è¡¨ç¤º
      ui.syncCrumb();
    }

    function childTitle(t){
      const el=document.createElement("div");
      el.className="section-title";
      el.textContent=t;
      return el;
    }

    async function boot(){
      app.DATA = await ui.safeFetchJSON("data.json");
      if(!app.DATA){
        ui.panel.innerHTML = '<div class="result ng"><h3>ã‚¨ãƒ©ãƒ¼</h3><p>data.json ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã€‚</p></div>';
        return;
      }
      ui.pushView("home",[]);
      render("home");
    }
    boot();
  </script>
</body>
</html>
