<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ä¿®ç†å—ä»˜ã‚³ãƒ³ã‚µãƒ«ãƒŠãƒ“ï¼ˆæ–°æ½Ÿã‚¨ãƒªã‚¢ç‰ˆï¼‰</title>
  <style>
    :root{
      --bg:#f7f9fc;
      --panel:#ffffff;
      --ink:#0b1220;
      --muted:#6b7280;
      --brand:#0b6bcb;
      --brand-ink:#ffffff;
      --ok:#e9f9ef;
      --warn:#fff9e6;
      --ng:#feeeee;
      --ring: rgba(11,107,203,.25);
      --chip:#eef2f7;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP","Yu Gothic UI","Yu Gothic",Meiryo,sans-serif;
      color:var(--ink);
      background:var(--bg);
    }
    .container{max-width:980px;margin:0 auto;padding:16px}
    header{
      background:linear-gradient(90deg,#0b6bcb,#0f2b6a);
      color:#fff;
      position:sticky;top:0;z-index:10;
    }
    header .bar{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:14px 16px}
    .title{font-weight:700;letter-spacing:.03em}
    .sub{font-size:12px;opacity:.9}
    .btn{
      appearance:none;border:0;border-radius:10px;padding:10px 14px;font-weight:600;
      background:#f1f5f9;color:#0b2b4a;cursor:pointer;transition:.15s;
      box-shadow:0 1px 0 rgba(0,0,0,.02), inset 0 0 0 1px #e5e7eb;
    }
    .btn:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(0,0,0,.08), inset 0 0 0 1px #dbe0e6}
    .btn.brand{background:var(--brand);color:var(--brand-ink);box-shadow:none}
    .card{background:var(--panel);border-radius:14px;box-shadow:0 1px 0 rgba(0,0,0,.04),0 10px 30px rgba(2,13,40,.06);padding:14px 16px;margin:14px 0}
    .heading{font-size:14px;color:var(--muted);margin-bottom:6px}
    .chip{display:inline-flex;align-items:center;gap:8px;background:var(--chip);border-radius:999px;padding:8px 12px;margin:6px 8px 6px 0;cursor:pointer;border:1px solid #e6ebf2}
    .chip:focus,.chip:active{outline: none; box-shadow:0 0 0 4px var(--ring)}
    .section-title{font-size:18px;font-weight:700;margin:10px 0 6px}
    .result{border-left:6px solid #d1e3ff;padding:10px 12px;border-radius:12px;margin:10px 0;background:var(--warn)}
    .result.ok{background:var(--ok);border-left-color:#22c55e}
    .result.warn{background:var(--warn);border-left-color:#f59e0b}
    .result.ng{background:var(--ng);border-left-color:#ef4444}
    .result h3{margin:0 0 6px;font-size:18px}
    .result p{margin:6px 0;line-height:1.7}
    .muted{color:var(--muted)}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .breadcrumb{font-size:12px;color:var(--muted);margin:6px 0 0}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    details.acd{background:var(--panel);border-radius:14px;box-shadow:0 1px 0 rgba(0,0,0,.04),0 8px 24px rgba(2,13,40,.06);padding:8px}
    details.acd > summary{list-style:none;cursor:pointer;padding:10px 12px;border-radius:12px;display:flex;gap:10px;align-items:center}
    details.acd > summary::marker, details.acd > summary::-webkit-details-marker {display:none}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{padding:10px;border-bottom:1px solid #eef2f7;text-align:left;font-size:14px}
    .table th{color:var(--muted);font-weight:600}
    .kbd{font-family: ui-monospace,SFMono-Regular,Menlo,monospace;background:#f3f4f6;border-radius:6px;padding:2px 6px}
    @media (max-width:640px){
      .btn{padding:9px 12px}
      .chip{padding:8px 10px}
    }
  </style>
</head>
<body>
  <header>
    <div class="bar container">
      <div>
        <div class="title">ä¿®ç†å—ä»˜ã‚³ãƒ³ã‚µãƒ«ãƒŠãƒ“ï¼ˆæ–°æ½Ÿã‚¨ãƒªã‚¢ç‰ˆï¼‰</div>
        <div class="sub">ãƒ¡ãƒ¼ã‚«ãƒ¼ãƒ»ä¿è¨¼ã®ãƒŠãƒ¬ãƒƒã‚¸ã‚’JSONã§ç®¡ç†ã—ã€èª°ã§ã‚‚åŒã˜åˆ¤æ–­ã‚’</div>
      </div>
      <a class="btn brand" href="https://docs.google.com/forms/d/e/1FAIpQLSc5pwJ5ahRwDdJiZNoXA0kSZ7Y9kufFVLL2kqACfH2yQFpsEA/viewform" target="_blank" rel="noopener">æ„è¦‹ã‚’é€ã‚‹ï¼ˆGoogleãƒ•ã‚©ãƒ¼ãƒ ï¼‰</a>
    </div>
  </header>

  <main class="container">
    <div id="crumb" class="breadcrumb">é€²è¡Œï¼šãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠ</div>

    <section class="card" id="panel"></section>

    <details class="acd" id="history">
      <summary>ğŸ•™ æ›´æ–°å±¥æ­´ï¼ˆã‚¿ãƒƒãƒ—ã§é–‹é–‰ï¼‰</summary>
      <div class="card" id="historyBody">
        <div class="muted" style="margin-bottom:6px">â€» å±¥æ­´ã¯ <span class="kbd">update_log.json</span> ã‚’èª­ã¿è¾¼ã¿è¡¨ç¤ºã—ã¾ã™ã€‚</div>
        <table class="table" id="historyTable">
          <thead><tr><th>æ—¥ä»˜</th><th>åº—èˆ—å</th><th>åå‰</th><th>æ›´æ–°å†…å®¹</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </details>

    <div class="controls">
      <button class="btn" id="backBtn">â† æˆ»ã‚‹</button>
      <button class="btn" id="homeBtn">æœ€åˆã‹ã‚‰</button>
    </div>
  </main>

  <script>
    const $ = (q, el = document) => el.querySelector(q);
    const panel = $("#panel");
    const crumb = $("#crumb");
    const backBtn = $("#backBtn");
    const homeBtn = $("#homeBtn");

    let DATA = null;
    let UPDATE_LOG = null;

    async function safeFetchJSON(path){
      try{
        const res = await fetch(path, {cache: "no-store"});
        if(!res.ok) throw new Error(res.status + " " + res.statusText);
        return await res.json();
      }catch(e){
        console.error("JSON load error:", path, e);
        return null;
      }
    }

    async function loadAll(){
      DATA = await safeFetchJSON("data.json");
      UPDATE_LOG = await safeFetchJSON("update_log.json");
      if(!DATA){
        renderError("è¨­å®šã‚¨ãƒ©ãƒ¼ï¼šdata.json ãŒèª­ã¿è¾¼ã‚ã¾ã›ã‚“ã€‚<br><small class='muted'>ãƒ•ã‚¡ã‚¤ãƒ«ã®é…ç½®ã¨JSONæ§‹æ–‡ã‚’ã”ç¢ºèªãã ã•ã„ã€‚</small>");
        return;
      }
      renderHome();
      renderHistory();
    }

    const stack = [];
    function pushCrumb(label){ stack.push(label); syncCrumb(); }
    function resetCrumb(){ stack.length = 0; syncCrumb(); }
    function syncCrumb(){ crumb.innerHTML = "é€²è¡Œï¼š " + (stack.length ? stack.join(" > ") : "ãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠ"); backBtn.disabled = stack.length === 0; }

    backBtn.addEventListener("click", ()=>{ renderHome(); });
    homeBtn.addEventListener("click", ()=>{ renderHome(); });

    function chip(label, handler){
      const el = document.createElement("button");
      el.className = "chip";
      el.textContent = label;
      el.onclick = handler;
      return el;
    }
    function childTitle(text){
      const h = document.createElement("div");
      h.className = "section-title";
      h.textContent = text;
      return h;
    }
    function cardResult(kind,title,lines){
      const el = document.createElement("div");
      el.className = "result " + (kind||"warn");
      el.innerHTML = `<h3>${title}</h3>${lines.map(p=>`<p>${p}</p>`).join("")}`;
      return el;
    }
    function renderError(html){
      panel.innerHTML = "";
      panel.append(cardResult("ng","è¨­å®šã‚¨ãƒ©ãƒ¼", [html]));
    }

    function renderHome(){
      resetCrumb();
      panel.innerHTML = "";
      const g = DATA.groups || {};

      const sec = document.createElement("div");
      if(g.domestic?.length){
        sec.append(childTitle("å›½å†…ãƒ¡ãƒ¼ã‚«ãƒ¼"));
        const row = document.createElement("div"); row.className = "row";
        g.domestic.forEach(m=> row.append(chip(m, ()=>{ pushCrumb(m); renderGenericMaker(m, []); })));
        sec.append(row);
      }
      if(g.overseas?.length){
        sec.append(childTitle("æµ·å¤–ãƒ¡ãƒ¼ã‚«ãƒ¼"));
        const row = document.createElement("div"); row.className = "row";
        g.overseas.forEach(m=> row.append(chip(m, ()=>{ pushCrumb(m); renderGenericMaker(m, [], {overseas:true}); })));
        sec.append(row);
      }
      if(g.surface?.length){
        sec.append(childTitle("Surface"));
        const row = document.createElement("div"); row.className = "row";
        g.surface.forEach(m=> row.append(chip(m, ()=>{ pushCrumb("Surface"); renderSurface(); })));
        sec.append(row);
      }
      if(g.apple?.length){
        sec.append(childTitle("Apple"));
        const row = document.createElement("div"); row.className = "row";
        g.apple.forEach(m=> row.append(chip(m, ()=>{ pushCrumb("Apple"); renderAppleStep([]); })));
        sec.append(row);
      }
      panel.append(sec);
      backBtn.disabled = true;
    }

    function renderSurface(){
      panel.innerHTML = "";
      const lines = [
        "å½“åº—ã§ã®ä¿®ç†å—ä»˜ã¯ã§ãã¾ã›ã‚“ã€‚ãŠå®¢æ§˜ã¨ãƒ¡ãƒ¼ã‚«ãƒ¼ã§ç›´æ¥ã®ã‚„ã‚Šå–ã‚Šã«ãªã‚Šã¾ã™ã€‚",
        "ãƒã‚¤ã‚¯ãƒ­ã‚½ãƒ•ãƒˆã‚µãƒãƒ¼ãƒˆã‚»ãƒ³ã‚¿ãƒ¼ï¼ˆSurfaceå°‚ç”¨ï¼‰",
        "é›»è©±ç•ªå·ï¼š0120-54-2244",
        "å—ä»˜æ™‚é–“ï¼šæœˆã€œé‡‘ 9:00ã€œ18:00ï¼ˆåœŸæ—¥ç¥ä¼‘ã¿ï¼‰"
      ];
      panel.append(cardResult("ng","åº—èˆ—ä¿®ç†å—ä»˜ä¸å¯ï¼ˆãƒ¡ãƒ¼ã‚«ãƒ¼ç›´æ¥ï¼‰", lines));
    }

    function renderAppleStep(path){
      panel.innerHTML = "";
      if(path.length === 0){
        panel.append(childTitle("ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿è¨¼ã®æœŸé–“å†…ã§ã™ã‹ï¼Ÿ"));
        const row = document.createElement("div"); row.className="row";
        row.append(chip("ã¯ã„", ()=>{ pushCrumb("ä¿è¨¼ï¼šã¯ã„"); renderAppleStep(["w_yes"]); }));
        row.append(chip("ã„ã„ãˆ", ()=>{ pushCrumb("ä¿è¨¼ï¼šã„ã„ãˆ"); renderAppleStep(["w_no"]); }));
        panel.append(row);
        return;
      }
      panel.append(cardResult("ng","åº—é ­å—ä»˜ä¸å¯ï¼ˆAppleã¸ç›´æ¥ï¼‰",["Appleã‚µãƒ¼ãƒ“ã‚¹&ã‚µãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ³ã€€0120-277-535"]));
    }

    function isOverseasMaker(name){ return (DATA.groups?.overseas||[]).includes(name); }

    function addMakerExtraInfoIfAny(maker){ /* omitted in compact test */ }

    function renderGenericMaker(maker, path, opts={}){
      panel.innerHTML = "";
      if(maker === "VAIO"){ pushCrumb("VAIO"); panel.append(childTitle("VAIOãƒ•ãƒ­ãƒ¼ï¼ˆçœç•¥ç‰ˆï¼‰")); return; }

      if(path.length === 0){
        panel.append(childTitle("ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿è¨¼ã®æœŸé–“å†…ã§ã™ã‹ï¼Ÿ"));
        const row = document.createElement("div"); row.className = "row";
        row.append(chip("ã¯ã„", ()=>{ pushCrumb("ä¿è¨¼ï¼šã¯ã„"); renderGenericMaker(maker, ["w_yes"], opts); }));
        row.append(chip("ã„ã„ãˆ", ()=>{ pushCrumb("ä¿è¨¼ï¼šã„ã„ãˆ"); renderGenericMaker(maker, ["w_no"], opts); }));
        panel.append(row); // â† é‡è¦ï¼šã“ã‚ŒãŒç„¡ã„ã¨ãƒœã‚¿ãƒ³ãŒå‡ºã¾ã›ã‚“
        return;
      }

      if(path[0] === "w_yes"){
        if(!isOverseasMaker(maker)){
          panel.append(cardResult("ok","ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿è¨¼å†…ã®å—ä»˜ï¼ˆæ³¨æ„äº‹é …ã‚ã‚Šï¼‰",[
            "ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿è¨¼å†…ã¨ã—ã¦å—ä»˜ã—ã¾ã™ã€‚",
            "ãŸã ã—ã€ç—‡çŠ¶ãŒæœªå†ç¾ã®å ´åˆã‚„ãŠå®¢æ§˜éƒ½åˆã®ä¿®ç†ä¸­æ­¢æ™‚ã«ã¯ã€è¦‹ç©ã‚‚ã‚Šæ‰‹æ•°æ–™ãŒç™ºç”Ÿã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚",
            "ãã®æ—¨ã‚’ãŠä¼ãˆã®ã†ãˆã€å—ä»˜ã‚’é€²ã‚ã¦ãã ã•ã„ã€‚",
            "ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿è¨¼æ›¸ç­‰ã‚’æ·»ä»˜ã®ä¸Šã€ä¿®ç†å—ä»˜ã‚’ã—ã¦ãã ã•ã„ã€‚"
          ]));
          return;
        }else{
          if(path.length===1){
            panel.append(childTitle("ãƒã‚¸ãƒã®ä¿è¨¼ã«å…¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ"));
            const row=document.createElement("div"); row.className="row";
            row.append(chip("ã¯ã„", ()=> renderGenericMaker(maker, ["w_yes","n_yes"], opts)));
            row.append(chip("ã„ã„ãˆ", ()=> renderGenericMaker(maker, ["w_yes","n_no"], opts)));
            panel.append(row);
            return;
          }
          if(path[1]==="n_yes"){
            panel.append(cardResult("ok","åº—èˆ—ã§ã®ä¿®ç†å—ä»˜ï¼šå¯¾å¿œå¯èƒ½ï¼ˆãƒã‚¸ãƒä¿è¨¼ï¼‰",[
              "ãƒã‚¸ãƒä¿è¨¼åŠ å…¥ã®ãŸã‚ã€åº—èˆ—ã§ä¿®ç†å—ä»˜ãŒå¯èƒ½ã§ã™ã€‚",
              "ç—‡çŠ¶æœªå†ç¾ã‚„ãŠå®¢æ§˜éƒ½åˆã®ä¿®ç†ä¸­æ­¢æ™‚ã¯è¦‹ç©ã‚Šä»£ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚"
            ]));
            return;
          }
          if(path[1]==="n_no"){
            panel.append(cardResult("warn","ä¿®ç†å—ä»˜å¯èƒ½ï¼ˆæ³¨æ„å–šèµ·ï¼‰",[
              "ãƒã‚¸ãƒåº—é ­ã§ã®ä¿®ç†å—ä»˜ã¯å¯èƒ½ã§ã™ã€‚",
              "ãŸã ã—ã€ãƒ¡ãƒ¼ã‚«ãƒ¼ã¸ç›´æ¥ä¾é ¼ã™ã‚‹ã‚ˆã‚Šä¿®ç†é‡‘é¡ãŒé«˜é¡ã«ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚",
              "ãŠå®¢æ§˜ã«ã”èª¬æ˜ã®ã†ãˆã€ã”åˆ¤æ–­ã‚’å°Šé‡ã—ã¦ãã ã•ã„ã€‚"
            ]));
            return;
          }
        }
      }

      if(path[0] === "w_no"){
        panel.append(cardResult("warn","ä¿®ç†å—ä»˜ã¯å¯èƒ½ï¼ˆå‰å—ã‘é‡‘ã‚ã‚Šï¼‰",[
          "å‰å—ã‘é‡‘5,500å††ï¼ˆç¾é‡‘ã®ã¿ï¼‰ã‚’ã„ãŸã ã„ã¦ä¿®ç†å—ä»˜å¯èƒ½ã§ã™ã€‚",
          "ä¿®ç†ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã€ãƒ¡ãƒ¼ã‚«ãƒ¼å´ã§å‰å—é‡‘ã‚’è¶…ãˆã‚‹è¦‹ç©ã‚‚ã‚Šè²»ãŒç™ºç”Ÿã—ã¦ã‚‚ã€ä»•å…¥ã‚Œå—ã‘å…¥ã‚Œæ™‚ã«é‡‘é¡5,500å††ã¸ä¿®æ­£OKã€‚"
        ]));
        return;
      }
    }

    function renderHistory(){
      const tbody = document.querySelector("#historyTable tbody");
      tbody.innerHTML = "";
      if(!Array.isArray(UPDATE_LOG)){
        tbody.innerHTML = `<tr><td colspan="4" class="muted">update_log.json ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€å½¢å¼ãŒä¸æ­£ã§ã™ã€‚</td></tr>`;
        return;
      }
      UPDATE_LOG.forEach(row=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${row.date||"-"}</td><td>${row.store||"-"}</td><td>${row.name||"-"}</td><td>${row.note||"-"}</td>`;
        tbody.append(tr);
      });
    }

    loadAll();
  </script>
</body>
</html>
