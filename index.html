<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ä¿®ç†å—ä»˜ã‚³ãƒ³ã‚µãƒ«ãƒŠãƒ“(æ–°æ½Ÿã‚¨ãƒªã‚¢ç‰ˆ)</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
      background: #f5f7fb;
      color: #222;
    }
    header {
      position: sticky; top: 0; z-index: 10;
      background: linear-gradient(90deg, #0f4cbd, #0b6ed0);
      color: #fff; padding: 14px 16px; display: flex; align-items: center; justify-content: space-between;
      box-shadow: 0 2px 10px rgba(0,0,0,.12);
    }
    header h1 { font-size: 18px; margin: 0; font-weight: 700; letter-spacing: .02em; }
    .btn {
      display:inline-block; border: 0; background: #0b6ed0; color: #fff;
      padding: 10px 14px; border-radius: 999px; font-weight: 600; cursor: pointer; text-decoration: none;
    }
    .btn.secondary { background:#e9eef9; color:#0b6ed0; }
    main { max-width: 980px; margin: 20px auto; padding: 0 16px; }
    .card {
      background:#fff; border-radius: 14px; padding: 16px; box-shadow: 0 6px 20px rgba(16,24,40,.06);
      margin-bottom: 16px;
    }
    .section-title { font-size: 14px; opacity:.7; margin:0 0 8px; }
    .grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(140px,1fr)); gap: 12px;
    }
    .pill {
      background:#eef3ff; color:#0b4fc9; border: 1px solid #dfe8ff;
      padding: 12px 14px; border-radius: 16px; text-align:center; cursor:pointer; font-weight:600;
    }
    .pill:hover { filter: brightness(0.97); }
    .toolbar { display:flex; gap:8px; }
    .breadcrumbs { font-size: 13px; color:#667085; margin-bottom:12px; }
    .result { border-radius: 12px; padding: 16px; }
    .result.success { background: #e9f9ef; border:1px solid #bfe7cd; }
    .result.warn    { background: #fff7e6; border:1px solid #ffe3a4; }
    .result.danger  { background: #fdeaea; border:1px solid #f3c0c0; }
    .result h3 { margin: 0 0 8px; font-size: 18px; }
    .result ul { margin: 0; padding-left: 0; list-style: none; }
    .result li { margin: 6px 0; }
    details.accordion { background:#fff; border-radius: 14px; padding: 8px 14px; }
    summary { cursor: pointer; font-weight: 700; }
    .spacer { height: 8px; }
  </style>
</head>
<body>
  <header>
    <h1>ä¿®ç†å—ä»˜ã‚³ãƒ³ã‚µãƒ«ãƒŠãƒ“(æ–°æ½Ÿã‚¨ãƒªã‚¢ç‰ˆ)</h1>
    <a class="btn" id="opinionBtn" href="https://docs.google.com/forms/d/e/1FAIpQLSc5pwJ5ahRwDdJiZNoXA0kSZ7Y9kufFVLL2kqACfH2yQFpsEA/viewform" target="_blank" rel="noopener">æ„è¦‹ã‚’é€ã‚‹ï¼ˆGoogleãƒ•ã‚©ãƒ¼ãƒ ï¼‰</a>
  </header>

  <main>
    <div class="card">
      <div class="breadcrumbs" id="trail">é€²è¡Œï¼šãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠ</div>
      <div id="view"></div>
      <div class="toolbar">
        <button class="btn secondary" id="backBtn">â† æˆ»ã‚‹</button>
        <button class="btn secondary" id="homeBtn">æœ€åˆã‹ã‚‰</button>
      </div>
    </div>

    <details class="accordion" id="logAcc">
      <summary>ğŸ•’ æ›´æ–°å±¥æ­´ï¼ˆã‚¿ãƒƒãƒ—ã§é–‹é–‰ï¼‰</summary>
      <div id="logs" class="spacer"></div>
    </details>
  </main>

  <script>
    // --- Fallback JSON (ä½¿ãˆãªã„å ´åˆã®ä¿é™º) ---
    const FALLBACK = {
      groups: {
        domestic: ["NEC","Fujitsu","Dynabook","VAIO","Mouse Computer"],
        overseas: ["ASUS","Dell","Lenovo","MSI"],
        surface: ["Surface"],
        apple: ["Apple"]
      },
      text: {
        common: { q_hasNojima: "ãƒã‚¸ãƒã®ä¿è¨¼ã«å…¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ" },
        domestic: {
          q_hasWarranty: "ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿è¨¼ã®æœŸé–“å†…ã§ã™ã‹ï¼Ÿ",
          r_warranty_title: "ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿è¨¼å†…ã®å—ä»˜ï¼ˆæ³¨æ„äº‹é …ã‚ã‚Šï¼‰",
          r_warranty_details: [
            "ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿è¨¼å†…ã¨ã—ã¦å—ä»˜ã—ã¾ã™ã€‚",
            "ãŸã ã—ã€ç—‡çŠ¶ãŒæœªå†ç¾ã®å ´åˆã‚„ãŠå®¢æ§˜éƒ½åˆã®ä¿®ç†ä¸­æ­¢æ™‚ã«ã¯ã€è¦‹ç©ã‚‚ã‚Šæ‰‹æ•°æ–™ãŒç™ºç”Ÿã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚",
            "ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿è¨¼æ›¸ç­‰ã‚’æ·»ä»˜ã®ä¸Šã€ä¿®ç†å—ä»˜ã‚’ã—ã¦ãã ã•ã„ã€‚"
          ],
          r_nojima_ok_title: "åº—èˆ—ã§ã®ä¿®ç†å—ä»˜ï¼šå¯èƒ½ï¼ˆãƒã‚¸ãƒä¿è¨¼ï¼‰",
          r_nojima_ok_details: [
            "åº—èˆ—ã§ã®ä¿®ç†å—ä»˜ã¯å¯èƒ½ã§ã™ã€‚",
            "ä¿è¨¼å¯¾è±¡å¤–ã¨ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹æ—¨ã‚’ãŠä¼ãˆã—ã¤ã¤ã€å—ä»˜ã‚’é€²ã‚ã¦ãã ã•ã„ã€‚",
            "å‰å—ã‘é‡‘ã¯å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã€‚"
          ],
          r_prepay_title: "ä¿®ç†å—ä»˜ã¯å¯èƒ½ï¼ˆå‰å—ã‘é‡‘ã‚ã‚Šï¼‰",
          r_prepay_details: [
            "å‰å—ã‘é‡‘5,500å††ï¼ˆç¾é‡‘ã®ã¿ï¼‰ã‚’ã„ãŸã ã„ã¦ä¿®ç†å—ä»˜å¯èƒ½ã§ã™ã€‚",
            "ä¿®ç†ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã€ãƒ¡ãƒ¼ã‚«ãƒ¼å´ã§å‰å—é‡‘ã‚’è¶…ãˆã‚‹è¦‹ç©ã‚‚ã‚Šè²»ãŒç™ºç”Ÿã—ã¦ã‚‚ã€ä»•å…¥ã‚Œå—ã‘å…¥ã‚Œæ™‚ã«é‡‘é¡5,500å††ã¸ä¿®æ­£OKã€‚",
            "BYODâ†’æ¥­å‹™ãƒ¡ãƒ‹ãƒ¥ãƒ¼â†’ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã€æ–‡ç« ç®¡ç†ã€‘â†’ç¬¬07ç«  ä¿®ç†æ¥­å‹™â†’ã€Œä¿®ç†å—ä»˜ã®ã‚ˆãã‚ã‚‹è³ªå•ã€â†’ã€Œå‰å—é‡‘ã«é–¢ã™ã‚‹ã“ã¨ ã€å‚ç…§"
          ]
        },
        overseas: {
          q_hasWarranty: "ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿è¨¼ã®æœŸé–“å†…ã§ã™ã‹ï¼Ÿ",
          r_warn_title: "ä¿®ç†å—ä»˜å¯èƒ½ï¼ˆæ³¨æ„å–šèµ·ï¼‰",
          r_warn_details: [
            "ãƒã‚¸ãƒã§ã®ä¿®ç†å—ä»˜ã¯å¯èƒ½ã§ã™ã€‚",
            "ãŸã ã—ã€ãƒ¡ãƒ¼ã‚«ãƒ¼ã¸ç›´æ¥ä¾é ¼ã™ã‚‹ã‚ˆã‚Šä¿®ç†é‡‘é¡ãŒé«˜é¡ã«ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚",
            "ãŠå®¢æ§˜ã«ã”èª¬æ˜ã®ã†ãˆã€ã”åˆ¤æ–­ã‚’å°Šé‡ã—ã¦ãã ã•ã„ã€‚"
          ],
          r_store_ok_title: "åº—èˆ—ã§ã®ä¿®ç†å—ä»˜ï¼šå¯¾å¿œå¯èƒ½",
          r_store_ok_details: [
            "ãƒã‚¸ãƒä¿è¨¼åŠ å…¥ã®ãŸã‚ã€åº—èˆ—ã§ä¿®ç†å—ä»˜ãŒå¯èƒ½ã§ã™ã€‚",
            "ç—‡çŠ¶æœªå†ç¾ã‚„ãŠå®¢æ§˜éƒ½åˆã®ä¿®ç†ä¸­æ­¢æ™‚ã¯è¦‹ç©ã‚Šä»£ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚"
          ]
        },
        surface: {
          r_title: "åº—èˆ—ä¿®ç†å—ä»˜ä¸å¯ï¼ˆSurfaceï¼‰",
          r_details: [
            "å½“åº—ã§ã®ä¿®ç†å—ä»˜ã¯ã§ãã¾ã›ã‚“ã€‚",
            "ãŠå®¢æ§˜ã¨ãƒ¡ãƒ¼ã‚«ãƒ¼ã§ç›´æ¥ã‚„ã‚Šå–ã‚Šã«ãªã‚Šã¾ã™ã€‚",
            "ãƒã‚¤ã‚¯ãƒ­ã‚½ãƒ•ãƒˆã‚µãƒãƒ¼ãƒˆã‚»ãƒ³ã‚¿ãƒ¼ï¼ˆSurfaceå°‚ç”¨ï¼‰",
            "é›»è©±ç•ªå·ï¼š0120-54-2244",
            "å—ä»˜æ™‚é–“ï¼šæœˆã€œé‡‘ 9:00ã€œ18:00ï¼ˆåœŸæ—¥ç¥ä¼‘ã¿ï¼‰"
          ]
        },
        apple: {
          q_hasWarranty: "ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿è¨¼ã®æœŸé–“å†…ã§ã™ã‹ï¼Ÿ",
          r_direct_title: "åº—é ­å—ä»˜ä¸å¯ï¼ˆAppleã¸ç›´æ¥æ¡ˆå†…ï¼‰",
          r_direct_details: [
            "ãƒã‚¸ãƒåº—é ­ã§ã®ä¿®ç†å—ä»˜ã¯ã§ãã¾ã›ã‚“ã€‚",
            "Appleã¨ãŠå®¢æ§˜ã§ç›´æ¥ã®ä¿®ç†å¯¾å¿œã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚",
            "Appleã‚µãƒ¼ãƒ“ã‚¹&ã‚µãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ³ï¼š0120-277-535"
          ]
        }
      }
    };

    async function loadJSON(url, fallback) {
      try {
        const resp = await fetch(url + "?v=" + Date.now(), {cache: "no-store"});
        if (!resp.ok) throw new Error("HTTP " + resp.status);
        return await resp.json();
      } catch (e) {
        console.warn("JSONã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ãŸãŸã‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ä½¿ç”¨ã—ã¾ã™:", e);
        return fallback;
      }
    }

    const state = { stack: [] };
    let DATA = null;

    const elView = document.getElementById("view");
    const elTrail = document.getElementById("trail");
    const elBack = document.getElementById("backBtn");
    const elHome = document.getElementById("homeBtn");

    elBack.addEventListener("click", () => {
      if (state.stack.length > 1) {
        state.stack.pop();
        const prev = state.stack[state.stack.length - 1];
        route(prev);
      }
    });
    elHome.addEventListener("click", () => goHome());

    function goHome() {
      state.stack = [{ route: "home" }];
      route(state.stack[0]);
    }

    function push(routeObj) {
      state.stack.push(routeObj);
      route(routeObj);
    }

    function setTrail(arr) {
      elTrail.textContent = "é€²è¡Œï¼š" + arr.join(" > ");
    }

    function renderMakers() {
      const groups = DATA.groups;
      const wrapper = document.createElement("div");
      // Heading row is implicit; we place all within one card but with group captions
      [["å›½å†…ãƒ¡ãƒ¼ã‚«ãƒ¼", "domestic"], ["æµ·å¤–ãƒ¡ãƒ¼ã‚«ãƒ¼", "overseas"], ["Surface", "surface"], ["Apple", "apple"]].forEach(([label, key]) => {
        const card = document.createElement("div");
        card.className = "spacer";
        const groupBox = document.createElement("div");
        groupBox.className = "grid";
        const caption = document.createElement("div");
        caption.className = "section-title";
        caption.textContent = label;
        wrapper.appendChild(caption);
        groups[key].forEach(name => {
          const b = document.createElement("div");
          b.className = "pill";
          b.textContent = name;
          b.addEventListener("click", () => push({ route: "maker", maker: name, group: key }));
          groupBox.appendChild(b);
        });
        wrapper.appendChild(groupBox);
        wrapper.appendChild(document.createElement("div")).className = "spacer";
      });
      elView.innerHTML = "";
      elView.appendChild(wrapper);
      setTrail(["ãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠ"]);
    }

    function renderYesNo(question, onYes, onNo) {
      const grid = document.createElement("div");
      grid.className = "grid";
      const yes = document.createElement("div");
      yes.className = "pill";
      yes.textContent = question + "ï¼ˆã¯ã„ï¼‰";
      yes.addEventListener("click", onYes);
      const no = document.createElement("div");
      no.className = "pill";
      no.textContent = question + "ï¼ˆã„ã„ãˆï¼‰";
      no.addEventListener("click", onNo);
      elView.innerHTML = "";
      elView.appendChild(grid);
      grid.appendChild(yes);
      grid.appendChild(no);
    }

    function renderResult(kind, title, details) {
      const box = document.createElement("div");
      box.className = "result " + (kind || "warn");
      const h3 = document.createElement("h3");
      h3.textContent = title;
      const ul = document.createElement("ul");
      details.forEach(t => {
        const li = document.createElement("li");
        li.textContent = t;
        ul.appendChild(li);
      });
      box.appendChild(h3);
      box.appendChild(ul);
      elView.innerHTML = "";
      elView.appendChild(box);
    }

    function route(routeObj) {
      switch (routeObj.route) {
        case "home":
          renderMakers();
          break;
        case "maker": {
          const { maker, group } = routeObj;
          setTrail(["ãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠ", maker]);
          if (group === "surface") {
            renderResult("danger", DATA.text.surface.r_title, DATA.text.surface.r_details);
          } else if (group === "apple") {
            // ç°¡æ˜“ç‰ˆï¼šAppleã¯åŸºæœ¬ã€ç›´æ¥æ¡ˆå†…ï¼ˆè¦ä»¶ã«åˆã‚ã›ã¦æ‹¡å¼µå¯ï¼‰
            renderResult("warn", DATA.text.apple.r_direct_title, DATA.text.apple.r_direct_details);
          } else if (group === "domestic") {
            const Q = DATA.text.domestic.q_hasWarranty;
            renderYesNo(Q,
              () => {
                setTrail(["ãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠ", maker, "ä¿è¨¼ã‚ã‚Š"]);
                renderResult("success", DATA.text.domestic.r_warranty_title, DATA.text.domestic.r_warranty_details);
              },
              () => {
                // ãƒã‚¸ãƒä¿è¨¼ã®æœ‰ç„¡
                const QQ = DATA.text.common.q_hasNojima;
                renderYesNo(QQ,
                  () => {
                    setTrail(["ãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠ", maker, "ãƒã‚¸ãƒä¿è¨¼ã‚ã‚Š"]);
                    renderResult("success", DATA.text.domestic.r_nojima_ok_title, DATA.text.domestic.r_nojima_ok_details);
                  },
                  () => {
                    setTrail(["ãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠ", maker, "ãƒã‚¸ãƒä¿è¨¼ãªã—"]);
                    renderResult("warn", DATA.text.domestic.r_prepay_title, DATA.text.domestic.r_prepay_details);
                  }
                );
              }
            );
          } else if (group === "overseas") {
            const Q = DATA.text.overseas.q_hasWarranty;
            renderYesNo(Q,
              () => {
                const QQ = DATA.text.common.q_hasNojima;
                renderYesNo(QQ,
                  () => {
                    setTrail(["ãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠ", maker, "ä¿è¨¼å†…", "ãƒã‚¸ãƒä¿è¨¼ã‚ã‚Š"]);
                    renderResult("success", DATA.text.overseas.r_store_ok_title, DATA.text.overseas.r_store_ok_details);
                  },
                  () => {
                    setTrail(["ãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠ", maker, "ä¿è¨¼å†…", "ãƒã‚¸ãƒä¿è¨¼ãªã—"]);
                    renderResult("warn", DATA.text.overseas.r_warn_title, DATA.text.overseas.r_warn_details);
                  }
                );
              },
              () => {
                setTrail(["ãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠ", maker, "ä¿è¨¼ãªã—"]);
                renderResult("warn", DATA.text.overseas.r_warn_title, DATA.text.overseas.r_warn_details);
              }
            );
          }
          break;
        }
      }
    }

    async function init() {
      DATA = await loadJSON("./data.json", FALLBACK);
      // æ›´æ–°å±¥æ­´
      const logsWrap = document.getElementById("logs");
      try {
        const log = await loadJSON("./update_log.json", { items: [] });
        const box = document.createElement("div");
        box.className = "card";
        if (!Array.isArray(log.items) || log.items.length === 0) {
          box.textContent = "å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚";
        } else {
          const ul = document.createElement("ul");
          ul.style.listStyle = "none";
          ul.style.padding = "0";
          log.items.forEach(it => {
            const li = document.createElement("li");
            li.style.padding = "8px 0";
            li.style.borderBottom = "1px dashed #e5e7eb";
            li.textContent = `${it.date}ï½œ${it.store}ï½œ${it.person}ï½œ${it.note}`;
            ul.appendChild(li);
          });
          box.appendChild(ul);
        }
        logsWrap.innerHTML = "";
        logsWrap.appendChild(box);
      } catch (e) {
        logsWrap.textContent = "å±¥æ­´ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
      }
      goHome();
    }

    init();
  </script>
</body>
</html>
