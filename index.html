<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>åº—é ­å¯¾å¿œãƒŠãƒ“ï¼ˆMVPï¼‰</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{ --brand:#004c99; --brand-dark:#00396f; --bg:#f5f7fb; --text:#1b1f24; --muted:#505a66;
         --card:#ffffff; --border:#e3e7ef; --ok:#16a34a; --warn:#f59e0b; --ng:#ef4444; --info:#3b82f6; }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:linear-gradient(180deg,#f7fbff 0%, #eef3fa 100%);color:var(--text);
       font-family:"Noto Sans JP",system-ui,-apple-system,Segoe UI,Helvetica,Arial,sans-serif;}
  .site-header{position:sticky;top:0;z-index:100;background:linear-gradient(90deg,var(--brand),var(--brand-dark));
               color:#fff;padding:14px 20px;box-shadow:0 4px 16px rgba(0,0,0,.08);display:flex;align-items:center;justify-content:space-between;}
  .site-header .title{font-size:20px;font-weight:700;letter-spacing:.02em}
  .site-header .subtitle{opacity:.9;font-size:12px;margin-top:2px}
  .site-actions a{display:inline-block;padding:8px 12px;border-radius:8px;
                  background:#ffffff18;border:1px solid #ffffff40;color:#fff;text-decoration:none;font-weight:600}
  .site-actions a:hover{background:#ffffff30;}
  .container{max-width:980px;margin:28px auto;padding:0 16px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;
        box-shadow:0 6px 20px rgba(0,0,0,.06);padding:18px;margin-bottom:18px}
  .section{margin-top:8px}
  .section h3{margin:6px 0 6px 0}
  .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 12px;min-width:120px;
       border:1px solid #cdd6e6;border-radius:10px;cursor:pointer;margin:8px 8px 0 0;
       background:linear-gradient(180deg,#ffffff 0%, #f3f6fb 100%);font-weight:600;color:#0f172a;transition:.18s ease;}
  .btn:hover{transform:translateY(-1px);box-shadow:0 8px 20px rgba(2,6,23,.08)}
  .btn.primary{border-color:#a8c6ff;background:linear-gradient(180deg,#e9f2ff 0%, #dbe9ff 100%)}
  .btn.linklike{min-width:auto;padding:10px 14px}
  .path{font-size:12px;color:var(--muted);margin-bottom:10px}
  .result{border:1px solid var(--border);border-radius:14px;padding:16px;background:#fcfffd}
  .result h2{margin:0 0 8px 0;font-size:18px}
  .result p{margin:6px 0}
  .result.ok{border-left:4px solid var(--ok)} .result.warn{border-left:4px solid var(--warn)}
  .result.ng{border-left:4px solid var(--ng)} .result.info{border-left:4px solid var(--info)}
  .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  .ghost{background:#fff;border:1px dashed var(--border);color:#666}
  .note{font-size:12px;color:#666;margin-top:8px}
  details.acc{border:1px solid var(--border);border-radius:14px;background:#fff;margin:10px 0;overflow:hidden}
  details.acc[open]{box-shadow:0 6px 20px rgba(0,0,0,.06)}
  details.acc > summary{padding:12px 14px;font-weight:700;cursor:pointer;list-style:none;
                        display:flex;align-items:center;gap:8px;background:#f6f9ff}
  details.acc > summary::-webkit-details-marker{display:none}
  .chev{transition:.15s ease;display:inline-block}
  details.acc[open] .chev{transform:rotate(90deg)}
</style>
</head>
<body>
<header class="site-header">
  <div>
    <div class="title">åº—é ­å¯¾å¿œãƒŠãƒ“ï¼ˆMVPï¼‰</div>
    <div class="subtitle">ãƒ¡ãƒ¼ã‚«ãƒ¼ãƒ»ä¿è¨¼ã®ãƒŠãƒ¬ãƒƒã‚¸ã‚’JSONã§ç®¡ç†ã—ã€èª°ã§ã‚‚åŒã˜åˆ¤æ–­ã‚’</div>
  </div>
  <div class="site-actions">
    <a id="formLink" href="https://docs.google.com/forms/d/e/1FAIpQLSc5pwJ5ahRwDdJiZNoXA0kSZ7Y9kufFVLL2kqACfH2yQFpsEA/viewform" target="_blank" rel="noopener">æ„è¦‹ã‚’é€ã‚‹ï¼ˆGoogleãƒ•ã‚©ãƒ¼ãƒ ï¼‰</a>
  </div>
</header>

<main class="container">
  <div class="card">
    <div class="path" id="path">é€²è¡Œï¼šãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠ</div>
    <div id="content">èª­ã¿è¾¼ã¿ä¸­â€¦</div>
    <div class="controls">
      <button class="btn ghost" id="backBtn" style="display:none">â† ã²ã¨ã¤æˆ»ã‚‹</button>
      <button class="btn primary" id="resetBtn">æœ€åˆã‹ã‚‰</button>
    </div>
  </div>

  <details class="acc card" id="historyAcc">
    <summary><span class="chev">â–¶</span> ğŸ•“ æ›´æ–°å±¥æ­´ï¼ˆã‚¿ãƒƒãƒ—ã§é–‹é–‰ï¼‰</summary>
    <div class="acc-body">
      <div id="logWrap" style="margin-top:10px"></div>
      <div class="note">â€» é–‹ã„ãŸã¨ãã«èª­ã¿è¾¼ã¿ï¼å„è¡Œã¯ã€Œè©³ç´°ã€ã‚’ã‚¿ãƒƒãƒ—ã§æœ¬æ–‡é–‹é–‰ã—ã¾ã™ã€‚</div>
    </div>
  </details>
</main>

<script>
const state = {
  path: [],
  stack: [],
  data: null
};

function setPath(text){ document.getElementById('path').textContent = 'é€²è¡Œï¼š' + text; }
function clearContent(){ document.getElementById('content').innerHTML = ''; }
function addButton(label, onClick){ 
  const btn = document.createElement('button'); 
  btn.className='btn'; btn.textContent=label; btn.onclick=onClick; 
  document.getElementById('content').appendChild(btn);
}
function addSectionTitle(title){
  const h3 = document.createElement('h3');
  h3.textContent = title;
  document.getElementById('content').appendChild(h3);
}
function addResult(kind, title, details){
  const box = document.createElement('div');
  box.className = 'result ' + (kind||'info');
  const h2 = document.createElement('h2'); h2.textContent = title; box.appendChild(h2);
  (details||[]).forEach(t => {
    const p = document.createElement('p'); p.textContent = t; box.appendChild(p);
  });
  document.getElementById('content').appendChild(box);
}
function showBack(show){ document.getElementById('backBtn').style.display = show ? '' : 'none'; }

function push(viewFn){
  // ä¿å­˜ã—ã¦ã‹ã‚‰é·ç§»
  const snapshot = document.getElementById('content').innerHTML;
  state.stack.push({path:[...state.path],html:snapshot});
  viewFn();
  showBack(true);
}
function goBack(){
  const last = state.stack.pop();
  if(!last){ home(); return; }
  state.path = last.path;
  document.getElementById('content').innerHTML = last.html;
  setPath(state.path.join(' > ') || 'ãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠ');
  showBack(state.stack.length>0);
}

function getGroupOf(maker){
  const g = state.data.groups;
  for(const key of Object.keys(g)){
    if(g[key].includes(maker)) return key;
  }
  return null;
}

/* ---------- ç”»é¢å®šç¾© ---------- */
function home(){
  state.path = [];
  state.stack = [];
  clearContent();
  setPath('ãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠ');

  const g = state.data.groups;
  const groupsUI = [
    ['å›½å†…ãƒ¡ãƒ¼ã‚«ãƒ¼', g.domestic||[]],
    ['æµ·å¤–ãƒ¡ãƒ¼ã‚«ãƒ¼', g.overseas||[]],
    ['Surface', g.surface||[]],
    ['Apple', g.apple||[]],
  ];

  groupsUI.forEach(([label, list]) => {
    if(!list || list.length===0) return;
    addSectionTitle(label);
    list.forEach(maker => addButton(maker, () => selectMaker(maker)));
  });
  showBack(false);
}

function selectMaker(maker){
  push(() => {
    state.path.push('ãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠ > ' + maker);
    clearContent();
    setPath(state.path.join(' > '));
    const group = getGroupOf(maker);
    if(group === 'domestic') viewDomestic(maker);
    else if(group === 'overseas') viewOverseas(maker);
    else if(group === 'surface') viewSurface(maker);
    else if(group === 'apple') viewApple(maker);
    else addResult('ng','è¨­å®šã‚¨ãƒ©ãƒ¼', ['ãƒ¡ãƒ¼ã‚«ãƒ¼ã®æ‰€å±ã‚°ãƒ«ãƒ¼ãƒ—ãŒä¸æ˜ã§ã™ã€‚data.json ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚']);
  });
}

/* --- å›½å†… --- */
function viewDomestic(maker){
  const t = state.data.text.domestic;
  const common = state.data.text.common;
  addSectionTitle(maker);
  addResult('info', t.q_hasWarranty, []);
  addButton('ã¯ã„', () => {
    push(() => {
      state.path.push('ä¿è¨¼ï¼šã¯ã„');
      clearContent(); setPath(state.path.join(' > '));
      addResult('ok', t.r_warranty_title, t.r_warranty_details);
    });
  });
  addButton('ã„ã„ãˆ', () => {
    push(() => {
      state.path.push('ä¿è¨¼ï¼šã„ã„ãˆ');
      clearContent(); setPath(state.path.join(' > '));
      addResult('info', common.q_hasNojima, []);
      addButton('ã¯ã„', () => {
        push(() => {
          state.path.push('ãƒã‚¸ãƒä¿è¨¼ï¼šã¯ã„');
          clearContent(); setPath(state.path.join(' > '));
          addResult('ok', t.r_nojima_ok_title, t.r_nojima_ok_details);
        });
      });
      addButton('ã„ã„ãˆ', () => {
        push(() => {
          state.path.push('ãƒã‚¸ãƒä¿è¨¼ï¼šã„ã„ãˆ');
          clearContent(); setPath(state.path.join(' > '));
          addResult('warn', t.r_prepay_title, t.r_prepay_details);
        });
      });
    });
  });
}

/* --- æµ·å¤– --- */
function viewOverseas(maker){
  const t = state.data.text.overseas;
  const common = state.data.text.common;
  addSectionTitle(maker);
  addResult('info', t.q_hasWarranty, []);
  addButton('ã¯ã„', () => {
    push(() => {
      state.path.push('ä¿è¨¼ï¼šã¯ã„');
      clearContent(); setPath(state.path.join(' > '));
      // ãƒã‚¸ãƒä¿è¨¼ã®æœ‰ç„¡
      addResult('info', common.q_hasNojima, []);
      addButton('ã¯ã„', () => {
        push(() => {
          state.path.push('ãƒã‚¸ãƒä¿è¨¼ï¼šã¯ã„');
          clearContent(); setPath(state.path.join(' > '));
          // åº—èˆ—å—ä»˜OKï¼ˆæ³¨æ„ï¼šæœªå†ç¾ãªã©ã§è¦‹ç©ä»£ãŒã‹ã‹ã‚‹æ—¨ã¯ warranty_details ã«å«ã‚€ï¼‰
          addResult('ok', t.r_store_ok_title, t.r_store_ok_details.concat(t.r_warranty_details||[]));
        });
      });
      addButton('ã„ã„ãˆ', () => {
        push(() => {
          state.path.push('ãƒã‚¸ãƒä¿è¨¼ï¼šã„ã„ãˆ');
          clearContent(); setPath(state.path.join(' > '));
          // ãƒã‚¸ãƒä¿è¨¼ãªã—ï¼šæ³¨æ„å–šèµ·ï¼ˆè²»ç”¨ãŒé«˜é¡åŒ–ã™ã‚‹å ´åˆï¼‰
          addResult('warn', t.r_warn_title, t.r_warn_details);
        });
      });
    });
  });
  addButton('ã„ã„ãˆ', () => {
    push(() => {
      state.path.push('ä¿è¨¼ï¼šã„ã„ãˆ');
      clearContent(); setPath(state.path.join(' > '));
      addResult('warn', t.r_warn_title, t.r_warn_details);
    });
  });
}

/* --- Surface --- */
function viewSurface(maker){
  const t = state.data.text.surface;
  addSectionTitle(maker);
  addResult('ng', t.r_title, t.r_details);
}

/* --- Apple --- */
function viewApple(maker){
  const t = state.data.text.apple;
  addSectionTitle(maker);
  addResult('info', t.q_hasWarranty, []);
  addButton('ã¯ã„', () => {
    push(() => {
      state.path.push('ä¿è¨¼ï¼šã¯ã„');
      clearContent(); setPath(state.path.join(' > '));
      addResult('ng', t.r_direct_title, t.r_direct_details);
    });
  });
  addButton('ã„ã„ãˆ', () => {
    push(() => {
      state.path.push('ä¿è¨¼ï¼šã„ã„ãˆ');
      clearContent(); setPath(state.path.join(' > '));
      addResult('ng', t.r_direct_title, t.r_direct_details);
    });
  });
}

/* --- æ›´æ–°å±¥æ­´ï¼ˆä»»æ„ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ --- */
async function loadUpdateLog(){
  const wrap = document.getElementById('logWrap');
  wrap.textContent = 'èª­ã¿è¾¼ã¿ä¸­â€¦';
  try{
    const res = await fetch('update_log.json', {cache:'no-store'});
    if(!res.ok) throw 0;
    const logs = await res.json();
    wrap.innerHTML = '';
    if(!Array.isArray(logs) || logs.length===0){
      wrap.textContent = 'å±¥æ­´ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚';
      return;
    }
    logs.forEach(item => {
      const row = document.createElement('details');
      row.className = 'acc';
      const sum = document.createElement('summary');
      sum.innerHTML = `<span class="chev">â–¶</span> ${item.date||''}ï½œ${item.store||''}ï½œ${item.person||''}ï½œ${item.maker||''}ï½œ${item.status||''}`;
      const body = document.createElement('div');
      body.style.padding = '12px 14px';
      body.textContent = item.details || '';
      row.appendChild(sum); row.appendChild(body);
      wrap.appendChild(row);
    });
  }catch(e){
    wrap.textContent = 'update_log.json ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼ˆå¿…è¦ã«å¿œã˜ã¦è¨­ç½®ã—ã¦ãã ã•ã„ï¼‰ã€‚';
  }
}

/* --- åˆæœŸåŒ– --- */
async function init(){
  document.getElementById('resetBtn').onclick = home;
  document.getElementById('backBtn').onclick = goBack;
  document.getElementById('historyAcc').addEventListener('toggle', (e)=>{
    if(e.target.open) loadUpdateLog();
  });

  try{
    const res = await fetch('data.json', {cache:'no-store'});
    if(!res.ok) throw new Error('data.json èª­ã¿è¾¼ã¿å¤±æ•—');
    state.data = await res.json();
    home();
  }catch(err){
    document.getElementById('content').innerHTML = '<p style="color:#b91c1c">è¨­å®šã‚¨ãƒ©ãƒ¼ï¼šdata.json ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚</p>';
    console.error(err);
  }
}
init();
</script>
</body>
</html>
