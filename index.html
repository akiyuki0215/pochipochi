<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ä¿®ç†å—ä»˜ã‚³ãƒ³ã‚µãƒ«ãƒŠãƒ“ï¼ˆæ–°æ½Ÿã‚¨ãƒªã‚¢ç‰ˆï¼‰</title>
  <style>
    :root{
      --bg:#f7f9fc;
      --panel:#ffffff;
      --ink:#0b1220;
      --muted:#6b7280;
      --brand:#0b6bcb;
      --brand-ink:#ffffff;
      --ok:#e9f9ef;
      --warn:#fff9e6;
      --ng:#feeeee;
      --ring: rgba(11,107,203,.25);
      --chip:#eef2f7;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Noto Sans JP","Yu Gothic UI","Yu Gothic",Meiryo,sans-serif;
      color:var(--ink);
      background:var(--bg);
    }
    .container{max-width:980px;margin:0 auto;padding:16px}
    header{
      background:linear-gradient(90deg,#0b6bcb,#0f2b6a);
      color:#fff;
      position:sticky;top:0;z-index:10;
    }
    header .bar{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:14px 16px}
    .title{font-weight:700;letter-spacing:.03em}
    .sub{font-size:12px;opacity:.9}
    .btn{
      appearance:none;border:0;border-radius:10px;padding:10px 14px;font-weight:600;
      background:#f1f5f9;color:#0b2b4a;cursor:pointer;transition:.15s;
      box-shadow:0 1px 0 rgba(0,0,0,.02), inset 0 0 0 1px #e5e7eb;
    }
    .btn:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(0,0,0,.08), inset 0 0 0 1px #dbe0e6}
    .btn.brand{background:var(--brand);color:var(--brand-ink);box-shadow:none}
    .card{background:var(--panel);border-radius:14px;box-shadow:0 1px 0 rgba(0,0,0,.04),0 10px 30px rgba(2,13,40,.06);padding:14px 16px;margin:14px 0}
    .heading{font-size:14px;color:var(--muted);margin-bottom:6px}
    .chip{display:inline-flex;align-items:center;gap:8px;background:var(--chip);border-radius:999px;padding:8px 12px;margin:6px 8px 6px 0;cursor:pointer;border:1px solid #e6ebf2}
    .chip:focus,.chip:active{outline: none; box-shadow:0 0 0 4px var(--ring)}
    .section-title{font-size:18px;font-weight:700;margin:10px 0 6px}
    .result{border-left:6px solid #d1e3ff;padding:10px 12px;border-radius:12px;margin:10px 0;background:var(--warn)}
    .result.ok{background:var(--ok);border-left-color:#22c55e}
    .result.warn{background:var(--warn);border-left-color:#f59e0b}
    .result.ng{background:var(--ng);border-left-color:#ef4444}
    .result h3{margin:0 0 6px;font-size:18px}
    .result p{margin:6px 0;line-height:1.7}
    .muted{color:var(--muted)}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .breadcrumb{font-size:12px;color:var(--muted);margin:6px 0 0}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    details.acd{background:var(--panel);border-radius:14px;box-shadow:0 1px 0 rgba(0,0,0,.04),0 8px 24px rgba(2,13,40,.06);padding:8px}
    details.acd > summary{list-style:none;cursor:pointer;padding:10px 12px;border-radius:12px;display:flex;gap:10px;align-items:center}
    details.acd > summary::marker, details.acd > summary::-webkit-details-marker {display:none}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{padding:10px;border-bottom:1px solid #eef2f7;text-align:left;font-size:14px}
    .table th{color:var(--muted);font-weight:600}
    .kbd{font-family: ui-monospace,SFMono-Regular,Menlo,monospace;background:#f3f4f6;border-radius:6px;padding:2px 6px}
    @media (max-width:640px){
      .btn{padding:9px 12px}
      .chip{padding:8px 10px}
    }
  </style>
</head>
<body>
  <header>
    <div class="bar container">
      <div>
        <div class="title">ä¿®ç†å—ä»˜ã‚³ãƒ³ã‚µãƒ«ãƒŠãƒ“ï¼ˆæ–°æ½Ÿã‚¨ãƒªã‚¢ç‰ˆï¼‰</div>
        <div class="sub">ãƒ¡ãƒ¼ã‚«ãƒ¼ãƒ»ä¿è¨¼ã®ãƒŠãƒ¬ãƒƒã‚¸ã‚’JSONã§ç®¡ç†ã—ã€èª°ã§ã‚‚åŒã˜åˆ¤æ–­ã‚’</div>
      </div>
      <a class="btn brand" href="https://docs.google.com/forms/d/e/1FAIpQLSc5pwJ5ahRwDdJiZNoXA0kSZ7Y9kufFVLL2kqACfH2yQFpsEA/viewform" target="_blank" rel="noopener">æ„è¦‹ã‚’é€ã‚‹ï¼ˆGoogleãƒ•ã‚©ãƒ¼ãƒ ï¼‰</a>
    </div>
  </header>

  <main class="container">
    <div id="crumb" class="breadcrumb">é€²è¡Œï¼šãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠ</div>

    <section class="card" id="panel"></section>

    <details class="acd" id="history">
      <summary>ğŸ•™ æ›´æ–°å±¥æ­´ï¼ˆã‚¿ãƒƒãƒ—ã§é–‹é–‰ï¼‰</summary>
      <div class="card" id="historyBody">
        <div class="muted" style="margin-bottom:6px">â€» å±¥æ­´ã¯ <span class="kbd">update_log.json</span> ã‚’èª­ã¿è¾¼ã¿è¡¨ç¤ºã—ã¾ã™ã€‚</div>
        <table class="table" id="historyTable">
          <thead><tr><th>æ—¥ä»˜</th><th>åº—èˆ—å</th><th>åå‰</th><th>æ›´æ–°å†…å®¹</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </details>

    <div class="controls">
      <button class="btn" id="backBtn">â† æˆ»ã‚‹</button>
      <button class="btn" id="homeBtn">æœ€åˆã‹ã‚‰</button>
    </div>
  </main>

  <script>
    // --- Utility ---
    const $ = (q, el = document) => el.querySelector(q);
    const $$ = (q, el = document) => Array.from(el.querySelectorAll(q));
    const panel = $("#panel");
    const crumb = $("#crumb");
    const backBtn = $("#backBtn");
    const homeBtn = $("#homeBtn");

    const GOOGLE_FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSc5pwJ5ahRwDdJiZNoXA0kSZ7Y9kufFVLL2kqACfH2yQFpsEA/viewform";

    // --- Data Loading ---
    let DATA = null;
    let UPDATE_LOG = null;

    async function safeFetchJSON(path){
      try{
        const res = await fetch(path, {cache: "no-store"});
        if(!res.ok) throw new Error(res.status + " " + res.statusText);
        return await res.json();
      }catch(e){
        console.error("JSON load error:", path, e);
        return null;
      }
    }

    async function loadAll(){
      DATA = await safeFetchJSON("data.json");
      UPDATE_LOG = await safeFetchJSON("update_log.json");
      if(!DATA){
        renderError("è¨­å®šã‚¨ãƒ©ãƒ¼ï¼šdata.json ãŒèª­ã¿è¾¼ã‚ã¾ã›ã‚“ã€‚<br><small class='muted'>ãƒ•ã‚¡ã‚¤ãƒ«ã®é…ç½®ã¨JSONæ§‹æ–‡ã‚’ã”ç¢ºèªãã ã•ã„ã€‚</small>");
        return;
      }
      renderHome();
      renderHistory();
    }

    // --- Navigation State ---
    const stack = []; // breadcrumbs
    function pushCrumb(label){ stack.push(label); syncCrumb(); }
    function popCrumb(){ stack.pop(); syncCrumb(); }
    function resetCrumb(){ stack.length = 0; syncCrumb(); }
    function syncCrumb(){
      crumb.innerHTML = "é€²è¡Œï¼š " + (stack.length ? stack.join(" > ") : "ãƒ¡ãƒ¼ã‚«ãƒ¼é¸æŠ");
      backBtn.disabled = stack.length === 0;
    }

    backBtn.addEventListener("click", ()=>{
      if(stack.length === 0){ return; }
      stack.pop();
      // re-render based on depth
      if(stack.length === 0) renderHome();
      else if(stack[0] === "Apple") renderAppleStep(stack.slice(1));
      else if(stack[0] === "Surface") renderSurface();
      else if(stack[0] === "VAIO") renderVAIOStep(stack.slice(1));
      else if(getAllMakers().includes(stack[0])) renderGenericMaker(stack[0], stack.slice(1));
      else renderHome();
    });
    homeBtn.addEventListener("click", ()=>{ renderHome(); });

    // --- Rendering helpers ---
    function chip(label, handler){
      const el = document.createElement("button");
      el.className = "chip";
      el.textContent = label;
      el.onclick = handler;
      return el;
    }
    function cardResult(kind,title,lines){
      const el = document.createElement("div");
      el.className = "result " + (kind||"warn");
      el.innerHTML = `<h3>${title}</h3>${lines.map(p=>`<p>${p}</p>`).join("")}`;
      return el;
    }
    function renderError(html){
      panel.innerHTML = "";
      panel.append(cardResult("ng","è¨­å®šã‚¨ãƒ©ãƒ¼", [html]));
    }

    // --- Home ---
    function getAllMakers(){
      const g = DATA?.groups || {};
      return [...(g.domestic||[]), ...(g.overseas||[]), ...(g.surface||[]), ...(g.apple||[])];
    }

    function renderHome(){
      resetCrumb();
      panel.innerHTML = "";
      const g = DATA.groups || {};

      const sec = document.createElement("div");
      // Domestic
      if(g.domestic?.length){
        sec.append(childTitle("å›½å†…ãƒ¡ãƒ¼ã‚«ãƒ¼"));
        const row = document.createElement("div"); row.className = "row";
        g.domestic.forEach(m=> row.append(chip(m, ()=>{ pushCrumb(m); renderGenericMaker(m, []); })));
        sec.append(row);
      }
      // Overseas
      if(g.overseas?.length){
        sec.append(childTitle("æµ·å¤–ãƒ¡ãƒ¼ã‚«ãƒ¼"));
        const row = document.createElement("div"); row.className = "row";
        g.overseas.forEach(m=> row.append(chip(m, ()=>{
          pushCrumb(m);
          renderGenericMaker(m, [], {overseas:true});
        })));
        sec.append(row);
      }
      // Surface
      if(g.surface?.length){
        sec.append(childTitle("Surface"));
        const row = document.createElement("div"); row.className = "row";
        g.surface.forEach(m=> row.append(chip(m, ()=>{
          pushCrumb("Surface");
          renderSurface();
        })));
        sec.append(row);
      }
      // Apple
      if(g.apple?.length){
        sec.append(childTitle("Apple"));
        const row = document.createElement("div"); row.className = "row";
        g.apple.forEach(m=> row.append(chip(m, ()=>{
          pushCrumb("Apple");
          renderAppleStep([]);
        })));
        sec.append(row);
      }

      panel.append(sec);
      $("#backBtn").disabled = true;
    }
    function childTitle(text){
      const h = document.createElement("div");
      h.className = "section-title";
      h.textContent = text;
      return h;
    }

    // --- Surface (Microsoft) ---
    function renderSurface(){
      panel.innerHTML = "";
      const lines = [
        "å½“åº—ã§ã®ä¿®ç†å—ä»˜ã¯ã§ãã¾ã›ã‚“ã€‚ãŠå®¢æ§˜ã¨ãƒ¡ãƒ¼ã‚«ãƒ¼ã§ç›´æ¥ã®ã‚„ã‚Šå–ã‚Šã«ãªã‚Šã¾ã™ã€‚",
        "ãƒã‚¤ã‚¯ãƒ­ã‚½ãƒ•ãƒˆã‚µãƒãƒ¼ãƒˆã‚»ãƒ³ã‚¿ãƒ¼ï¼ˆSurfaceå°‚ç”¨ï¼‰",
        "é›»è©±ç•ªå·ï¼š0120-54-2244",
        "å—ä»˜æ™‚é–“ï¼šæœˆã€œé‡‘ 9:00ã€œ18:00ï¼ˆåœŸæ—¥ç¥ä¼‘ã¿ï¼‰"
      ];
      panel.append(cardResult("ng","åº—èˆ—ä¿®ç†å—ä»˜ä¸å¯ï¼ˆãƒ¡ãƒ¼ã‚«ãƒ¼ç›´æ¥ï¼‰", lines));
    }

    // --- VAIO special flow ---
    function renderVAIOStep(path){
      panel.innerHTML = "";
      if(path.length === 0){
        const q = document.createElement("div");
        q.className = "section-title";
        q.textContent = "Sonyæ ªå¼ä¼šç¤¾ãŒè²©å£²ã—ã¦ã„ã‚‹VAIOã§ã™ã‹ï¼Ÿ ãã‚Œã¨ã‚‚ VAIOæ ªå¼ä¼šç¤¾ãŒè²©å£²ã—ã¦ã„ã‚‹VAIOã§ã™ã‹ï¼Ÿ";
        panel.append(q);
        panel.append(childTitle("æ™‚æœŸç›®å®‰ãƒ»è£½é€ å…ƒ"));
        const row = document.createElement("div"); row.className="row";
        row.append(chip("Sonyæ ªå¼ä¼šç¤¾ã®VAIO", ()=>{ pushCrumb("Sonyè£½VAIO"); renderVAIOStep(["sony"]); }));
        row.append(chip("VAIOæ ªå¼ä¼šç¤¾ã®VAIO", ()=>{ pushCrumb("VAIOç¤¾è£½VAIO"); renderVAIOStep(["vaio"])}));
        panel.append(row);
        return;
      }
      if(path[0] === "sony"){
        const lines = [
          "Sonyæ ªå¼ä¼šç¤¾ãŒè²©å£²ã—ã¦ã„ã‚‹VAIOè£½å“ã®ä¿®ç†å—ä»˜ã¯çµ‚äº†ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã§ã™ãŒã€ä¸‹è¨˜ã«ã¦å•ã„åˆã‚ã›å¯èƒ½ã§ã™ã€‚",
          "VAIOã‚«ã‚¹ã‚¿ãƒãƒ¼ãƒªãƒ³ã‚¯ä¿®ç†ç›¸è«‡çª“å£ï¼š0120-60-5599ï¼ˆãƒ•ãƒªãƒ¼ãƒ€ã‚¤ãƒ¤ãƒ«ï¼‰",
          "å—ä»˜æ™‚é–“ï¼šæœˆï½é‡‘ 9:00ï½18:00ï¼ˆç¥æ—¥ãƒ»å¹´æœ«å¹´å§‹é™¤ãï¼‰"
        ];
        panel.append(cardResult("ng","Sonyè£½VAIOï¼ˆæ—§æ©Ÿç¨®ï¼‰",lines));
        return;
      }
      if(path[0] === "vaio"){
        if(path.length === 1){
          const q = document.createElement("div");
          q.className = "section-title";
          q.textContent = "å½“ç¤¾ï¼ˆãƒã‚¸ãƒï¼‰ã§è³¼å…¥ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ";
          panel.append(q);
          const row = document.createElement("div"); row.className="row";
          row.append(chip("ã¯ã„", ()=>{ pushCrumb("å½“ç¤¾è³¼å…¥ï¼šã¯ã„"); renderVAIOStep(["vaio","yes"]); }));
          row.append(chip("ã„ã„ãˆ", ()=>{ pushCrumb("å½“ç¤¾è³¼å…¥ï¼šã„ã„ãˆ"); renderVAIOStep(["vaio","no"]); }));
          return;
        }
        if(path[1] === "yes"){
          const lines = [
            "åº—èˆ—ã§ä¿®ç†å—ä»˜ãŒå¯èƒ½ã§ã™ã€‚å¿…è¦æ›¸é¡ã‚’ã”æ¡ˆå†…ã®ã†ãˆå—ä»˜ã—ã¦ãã ã•ã„ã€‚",
            "ä¿®ç†ä¾é ¼å…ˆ: ãƒã‚¸ãƒä¿®ç†ã‚»ãƒ³ã‚¿ãƒ¼ï¼ˆä¿®ç†ã‚»ãƒ³ã‚¿ãƒ¼çµŒç”±ã§VAIOã¸ä¿®ç†ä¾é ¼ï¼‰",
            "ä¿å®ˆæœŸé–“: ç™ºå£²æ—¥ã‹ã‚‰ç´„5å¹´ï¼ˆç›®å®‰ï¼‰"
          ];
          panel.append(cardResult("ok","åº—èˆ—ã§ã®ä¿®ç†å—ä»˜ï¼šå¯èƒ½ï¼ˆå½“ç¤¾è³¼å…¥ï¼‰",lines));
          return;
        }
        if(path[1] === "no"){
          const lines = [
            "åº—èˆ—ã§ã®ä¿®ç†å—ä»˜ã¯å¯èƒ½ã§ã™ã€‚",
            "ãŸã ã—ã€ãŠå®¢æ§˜ãŒãƒ¡ãƒ¼ã‚«ãƒ¼ã¨ç›´æ¥ã‚„ã‚Šå–ã‚Šã™ã‚‹ã‚ˆã‚Šã‚‚é«˜é¡ã«ãªã‚‹å¯èƒ½æ€§ãŒé«˜ã„ç‚¹ã‚’ã”èª¬æ˜ã®ã†ãˆã€å—ä»˜ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚"
          ];
          panel.append(cardResult("warn","åº—èˆ—ä¿®ç†å—ä»˜ã¯å¯èƒ½ï¼ˆä¾¡æ ¼ã«ã”æ³¨æ„ï¼‰",lines));
          return;
        }
      }
    }

    // --- Apple flow ---
    function renderAppleStep(path){
      panel.innerHTML = "";
      if(path.length === 0){
        panel.append(childTitle("ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿è¨¼ã®æœŸé–“å†…ã§ã™ã‹ï¼Ÿ"));
        const row = document.createElement("div"); row.className="row";
        row.append(chip("ã¯ã„", ()=>{ pushCrumb("ä¿è¨¼ï¼šã¯ã„"); renderAppleStep(["w_yes"]); }));
        row.append(chip("ã„ã„ãˆ", ()=>{ pushCrumb("ä¿è¨¼ï¼šã„ã„ãˆ"); renderAppleStep(["w_no"]); }));
        return;
      }
      // ä¿è¨¼å†… â†’ ãƒã‚¸ãƒä¿è¨¼ã®ç¨®é¡
      if(path[0] === "w_yes"){
        panel.append(childTitle("ãƒã‚¸ãƒä¿è¨¼ã®ã”åŠ å…¥çŠ¶æ³ã‚’é¸æŠã—ã¦ãã ã•ã„"));
        const row = document.createElement("div"); row.className="row";
        row.append(chip("â‘  ã‚¢ãƒ«ãƒ†ã‚£ãƒ¡ãƒƒãƒˆä¿è¨¼", ()=>{ pushCrumb("ã‚¢ãƒ«ãƒ†ã‚£ãƒ¡ãƒƒãƒˆ"); renderAppleStep(["ult"]); }));
        row.append(chip("â‘¡ ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä¿è¨¼ãƒ—ãƒ©ã‚¹", ()=>{ pushCrumb("ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä¿è¨¼ãƒ—ãƒ©ã‚¹"); renderAppleStep(["pp"]); }));
        row.append(chip("â‘¢ ä¿è¨¼ã«å…¥ã£ã¦ã„ãªã„", ()=>{ pushCrumb("æœªåŠ å…¥"); renderAppleStep(["none"]); }));
        return;
      }
      if(path[0] === "ult"){
        const lines=[
          "åº—èˆ—ã§ã®å•†å“äº¤æ›ã¾ãŸã¯ãƒã‚¤ãƒ³ãƒˆãƒãƒƒã‚¯å¯¾å¿œãŒå¯èƒ½ã§ã™ã€‚",
          "ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ï¼ˆMDï¼‰ã‚’ç¢ºèªã—ãªãŒã‚‰å¯¾å¿œã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚",
          "Appleã‚µãƒ¼ãƒ“ã‚¹&ã‚µãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ³ã€€0120-277-535 ã‚‚ä½µè¨˜ã®ã†ãˆã”æ¡ˆå†…å¯èƒ½ã§ã™ã€‚"
        ];
        panel.append(cardResult("ok","åº—èˆ—ã§ã®å•†å“äº¤æ›ãƒ»ãƒã‚¤ãƒ³ãƒˆãƒãƒƒã‚¯å¯¾å¿œï¼ˆã‚¢ãƒ«ãƒ†ã‚£ãƒ¡ãƒƒãƒˆä¿è¨¼ï¼‰",lines));
        return;
      }
      if(path[0] === "pp"){
        if(path.length === 1){
          panel.append(childTitle("2023å¹´6æœˆ1æ—¥ä»¥é™ã«è³¼å…¥ã•ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ"));
          const row=document.createElement("div"); row.className="row";
          row.append(chip("ã¯ã„", ()=>{ pushCrumb("2023/6/1 ä»¥é™"); renderAppleStep(["pp","aft"]); }));
          row.append(chip("ã„ã„ãˆ", ()=>{ pushCrumb("ãã‚Œä»¥å‰"); renderAppleStep(["pp","bef"]); }));
          return;
        }
        if(path[1] === "aft"){
          const lines=[
            "Appleç”¨ã®è£½å“ä¿®ç†ç”³è¾¼æ›¸ã‚’è¨˜è¼‰ã®ä¸Šã€ä¿®ç†å—ä»˜ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚",
            "ãƒã‚¤ãƒ³ãƒˆãƒãƒƒã‚¯ã§ã®å¯¾å¿œã«ãªã‚Šã¾ã™ã€‚",
            "è‡ªç„¶æ•…éšœãƒ»ç‰©æã®å ´åˆã§ãƒ•ãƒ­ãƒ¼ãŒå¤‰ã‚ã‚‹ãŸã‚ã€è©³ç´°ã¯MDç­‰ã¸ç¢ºèªã‚’è¡Œã£ã¦ãã ã•ã„ã€‚",
            "â€» Appleè£½å“ä¿®ç†ç”³è¾¼æ›¸ã¯ãƒ‡ã‚¹ã‚¯ãƒãƒƒãƒ„ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡ºæ¥ã¾ã™",
            "Appleã‚µãƒ¼ãƒ“ã‚¹&ã‚µãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ³ã€€0120-277-535"
          ];
          panel.append(cardResult("warn","åº—é ­å—ä»˜â†’ãƒã‚¤ãƒ³ãƒˆãƒãƒƒã‚¯ï¼ˆãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä¿è¨¼ãƒ—ãƒ©ã‚¹ / 2023-06-01ä»¥é™ï¼‰",lines));
          return;
        }
        if(path[1] === "bef"){
          const lines=[
            "é€šå¸¸é€šã‚Šä¿®ç†å—ä»˜ã‚’ã—ã¦ãã ã•ã„ã€‚",
            "ææºä¿®ç†å…ˆã‚¦ãƒãƒ€ã‚¨ã‚¹ã‚³ã§ã®ä¿®ç†å¯¾å¿œã«ãªã‚Šã¾ã™ã€‚",
            "Appleç”¨è£½å“ä¿®ç†ç”³è¾¼æ›¸ã‚’è¨˜è¼‰ã®ä¸Šã€ä¿®ç†å—ä»˜ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚",
            "â€» Appleè£½å“ä¿®ç†ç”³è¾¼æ›¸ã¯ãƒ‡ã‚¹ã‚¯ãƒãƒƒãƒ„ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡ºæ¥ã¾ã™",
            "Appleã‚µãƒ¼ãƒ“ã‚¹&ã‚µãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ³ã€€0120-277-535"
          ];
          panel.append(cardResult("ok","åº—é ­ä¿®ç†å—ä»˜ï¼ˆã‚¦ãƒãƒ€ã‚¨ã‚¹ã‚³é€ä»˜ / ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä¿è¨¼ãƒ—ãƒ©ã‚¹ï¼‰ã€",lines));
          return;
        }
      }
      if(path[0] === "none" || path[0] === "w_no"){
        const lines=[
          "ãƒã‚¸ãƒåº—é ­ã§ã®ä¿®ç†å—ä»˜ã¯ã§ãã¾ã›ã‚“ã€‚",
          "Appleã¨ãŠå®¢æ§˜ã§ç›´æ¥ã®ä¿®ç†å¯¾å¿œã‚’ã”æ¡ˆå†…ãã ã•ã„ã€‚",
          "Appleã‚µãƒ¼ãƒ“ã‚¹&ã‚µãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ³ã€€0120-277-535"
        ];
        panel.append(cardResult("ng","åº—é ­å—ä»˜ä¸å¯ï¼ˆAppleã¸ç›´æ¥ï¼‰",lines));
        return;
      }
    }

    // --- Generic maker flow (Domestic / Overseas) ---
    function isOverseasMaker(name){
      return (DATA.groups?.overseas||[]).includes(name);
    }

    function renderGenericMaker(maker, path, opts={}){
      panel.innerHTML = "";
      // Special-case VAIO label routes into VAIO flow
      if(maker === "VAIO"){
        pushCrumb("VAIO");
        renderVAIOStep([]);
        return;
      }

      // Q1: ä¿è¨¼æœŸé–“å†…ï¼Ÿ
      if(path.length === 0){
        panel.append(childTitle("ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿è¨¼ã®æœŸé–“å†…ã§ã™ã‹ï¼Ÿ"));
        const row = document.createElement("div"); row.className="row";
        row.append(chip("ã¯ã„", ()=>{ pushCrumb("ä¿è¨¼ï¼šã¯ã„"); renderGenericMaker(maker, ["w_yes"], opts); }));
        row.append(chip("ã„ã„ãˆ", ()=>{ pushCrumb("ä¿è¨¼ï¼šã„ã„ãˆ"); renderGenericMaker(maker, ["w_no"], opts); }));
        return;
      }

      // ä¿è¨¼å†…
      if(path[0] === "w_yes"){
        // Domestic: ãã®ã¾ã¾æ³¨æ„æ–‡ã§å—ä»˜OK
        if(!isOverseasMaker(maker)){
          const lines=[
            "ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿è¨¼å†…ã¨ã—ã¦å—ä»˜ã—ã¾ã™ã€‚",
            "ãŸã ã—ã€ç—‡çŠ¶ãŒæœªå†ç¾ã®å ´åˆã‚„ãŠå®¢æ§˜éƒ½åˆã®ä¿®ç†ä¸­æ­¢æ™‚ã«ã¯ã€è¦‹ç©ã‚‚ã‚Šæ‰‹æ•°æ–™ãŒç™ºç”Ÿã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚",
            "ãã®æ—¨ã‚’ãŠä¼ãˆã®ã†ãˆã€å—ä»˜ã‚’é€²ã‚ã¦ãã ã•ã„ã€‚",
            "ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿è¨¼æ›¸ç­‰ã‚’æ·»ä»˜ã®ä¸Šã€ä¿®ç†å—ä»˜ã‚’ã—ã¦ãã ã•ã„ã€‚"
          ];
          panel.append(cardResult("ok","ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿è¨¼å†…ã®å—ä»˜ï¼ˆæ³¨æ„äº‹é …ã‚ã‚Šï¼‰",lines));
          addMakerExtraInfoIfAny(maker);
          return;
        }else{
          // Overseas: ã¾ãšãƒã‚¸ãƒä¿è¨¼ã®æœ‰ç„¡
          if(path.length===1){
            panel.append(childTitle("ãƒã‚¸ãƒã®ä¿è¨¼ã«å…¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ"));
            const row=document.createElement("div"); row.className="row";
            row.append(chip("ã¯ã„", ()=>{ pushCrumb("ãƒã‚¸ãƒä¿è¨¼ï¼šã‚ã‚Š"); renderGenericMaker(maker, ["w_yes","n_yes"], opts);}));
            row.append(chip("ã„ã„ãˆ", ()=>{ pushCrumb("ãƒã‚¸ãƒä¿è¨¼ï¼šãªã—"); renderGenericMaker(maker, ["w_yes","n_no"], opts);}));
            return;
          }
          if(path[1] === "n_yes"){
            const lines=[
              "ãƒã‚¸ãƒä¿è¨¼åŠ å…¥ã®ãŸã‚ã€åº—èˆ—ã§ä¿®ç†å—ä»˜ãŒå¯èƒ½ã§ã™ã€‚",
              "ç—‡çŠ¶æœªå†ç¾ã‚„ãŠå®¢æ§˜éƒ½åˆã®ä¿®ç†ä¸­æ­¢æ™‚ã¯è¦‹ç©ã‚Šä»£ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚"
            ];
            panel.append(cardResult("ok","åº—èˆ—ã§ã®ä¿®ç†å—ä»˜ï¼šå¯¾å¿œå¯èƒ½ï¼ˆãƒã‚¸ãƒä¿è¨¼ï¼‰",lines));
            addMakerExtraInfoIfAny(maker);
            return;
          }
          if(path[1] === "n_no"){
            const lines=[
              "ãƒã‚¸ãƒåº—é ­ã§ã®ä¿®ç†å—ä»˜ã¯å¯èƒ½ã§ã™ã€‚",
              "ãŸã ã—ã€ãƒ¡ãƒ¼ã‚«ãƒ¼ã¸ç›´æ¥ä¾é ¼ã™ã‚‹ã‚ˆã‚Šä¿®ç†é‡‘é¡ãŒé«˜é¡ã«ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚",
              "ãŠå®¢æ§˜ã«ã”èª¬æ˜ã®ã†ãˆã€ã”åˆ¤æ–­ã‚’å°Šé‡ã—ã¦ãã ã•ã„ã€‚"
            ];
            panel.append(cardResult("warn","ä¿®ç†å—ä»˜å¯èƒ½ï¼ˆæ³¨æ„å–šèµ·ï¼‰",lines));
            addMakerExtraInfoIfAny(maker);
            return;
          }
        }
      }

      // ä¿è¨¼å¤–
      if(path[0] === "w_no"){
        const lines=[
          "å‰å—ã‘é‡‘5,500å††ï¼ˆç¾é‡‘ã®ã¿ï¼‰ã‚’ã„ãŸã ã„ã¦ä¿®ç†å—ä»˜å¯èƒ½ã§ã™ã€‚",
          "ä¿®ç†ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã€ãƒ¡ãƒ¼ã‚«ãƒ¼å´ã§å‰å—é‡‘ã‚’è¶…ãˆã‚‹è¦‹ç©ã‚‚ã‚Šè²»ãŒç™ºç”Ÿã—ã¦ã‚‚ã€ä»•å…¥ã‚Œå—ã‘å…¥ã‚Œæ™‚ã«é‡‘é¡5,500å††ã¸ä¿®æ­£OKã€‚",
          "BYODâ†’æ¥­å‹™ãƒ¡ãƒ‹ãƒ¥ãƒ¼â†’ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã€æ–‡ç« ç®¡ç†ã€‘â†’ç¬¬07ç«  ä¿®ç†æ¥­å‹™â†’ã€Œä¿®ç†å—ä»˜ã®ã‚ˆãã‚ã‚‹è³ªå•ã€â†’ã€Œå‰å—é‡‘ã«é–¢ã™ã‚‹ã“ã¨ ã€å‚ç…§"
        ];
        panel.append(cardResult("warn","ä¿®ç†å—ä»˜ã¯å¯èƒ½ï¼ˆå‰å—ã‘é‡‘ã‚ã‚Šï¼‰",lines));
        addMakerExtraInfoIfAny(maker);
        return;
      }
    }

    function addMakerExtraInfoIfAny(maker){
      // Adds the supplemental information blocks for specific makers (Mouse, Dell, Dynabook, NEC, Fujitsu, Lenovo, MSI)
      const extra = {
        "Mouse Computer": [
          "<strong>ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿®ç†ä¾é ¼ãƒ•ãƒ­ãƒ¼</strong>",
          "å›åæ–¹æ³•ã‚’é›»è©±ã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚",
          "ã€’344-0063 åŸ¼ç‰çœŒæ˜¥æ—¥éƒ¨å¸‚ç·‘ç”º6-14-53",
          "æ ªå¼ä¼šç¤¾MCJã€€åŸ¼ç‰ã‚µãƒ¼ãƒ“ã‚¹ã‚»ãƒ³ã‚¿ãƒ¼",
          "TELï¼š0570-08-8222 / FAXï¼š048-739-1315"
        ],
        "Dell":[
          "<strong>DELL è£œè¶³æƒ…å ±</strong>",
          "ä¿å®ˆæœŸé–“: ç”Ÿç”£å®Œäº†ã‹ã‚‰3å¹´",
          "ä¿®ç†ä¾é ¼å…ˆ: ãƒ€ã‚¤ãƒ¯ãƒœã‚¦æƒ…å ±ã‚·ã‚¹ãƒ†ãƒ ï¼ˆä¿®ç†è‡ªå‹•é›†è·ï¼‰"
        ],
        "Dynabook":[
          "<strong>ãƒ€ã‚¤ãƒŠãƒ–ãƒƒã‚¯ è£œè¶³æƒ…å ±</strong>",
          "dynabook é›†ä¸­ä¿®ç†ã‚»ãƒ³ã‚¿ãƒ¼",
          "ç„¡æ–™é€šè©±ç•ªå· 0120-97-1048",
          "æºå¸¯é›»è©±ã‹ã‚‰ã¯ 043-298-8780"
        ],
        "NEC":[
          "<strong>NEC è£œè¶³æƒ…å ±</strong>",
          "ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿®ç†ä¾é ¼ãƒ•ãƒ­ãƒ¼ï¼šä¿®ç†å¼•ãå–ã‚Šè¦è«‹ã®éš›ã«ã€äº‹å‰ã®é›»è©±é€£çµ¡ãŒå¿…è¦ï¼ˆ0120-729-121ï¼‰",
          "ã€’373-0823 ç¾¤é¦¬çœŒå¤ªç”°å¸‚è¥¿çŸ¢å³¶ç”º32 NECç¾¤é¦¬ã‚µãƒ¼ãƒ“ã‚¹ã‚»ãƒ³ã‚¿ãƒ¼",
          "TEL: 0276-38-0007 / FAX: 0276-38-0026",
          "æ—¥æ›œç¥æ—¥ã‚’é™¤ãæœˆã€œåœŸï¼š9:00ã€œ17:30 â€»åœ°åŸŸã«ã‚ˆã‚Šç•°ãªã‚‹å¯èƒ½æ€§ã‚ã‚Š"
        ],
        "Fujitsu":[
          "<strong>å¯Œå£«é€š è£œè¶³æƒ…å ±</strong>",
          "ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿®ç†ä¾é ¼ãƒ•ãƒ­ãƒ¼ï¼šä¾é ¼æ›¸ã‚’FAX 024-575-5019 â†’ åº—èˆ—ã«ã¦å¼•ãå–ã‚Š",
          "ç¦å³¶çœŒä¼Šé”å¸‚ä¿åŸç”ºä¸Šé‡å´37-3 å¯Œå£«é€š æ±æ—¥æœ¬ãƒ†ã‚¯ãƒã‚»ãƒ³ã‚¿ãƒ¼",
          "TELï¼š024-575-5012 / FAXï¼š024-575-5019",
          "å¹³æ—¥ 9:00ã€œ17:00 â€»åœ°åŸŸã«ã‚ˆã‚Šç•°ãªã‚‹å¯èƒ½æ€§ã‚ã‚Š"
        ],
        "Lenovo":[
          "<strong>ãƒ¬ãƒãƒœ è£œè¶³æƒ…å ±</strong>",
          "ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿®ç†ä¾é ¼ãƒ•ãƒ­ãƒ¼ï¼šå›åæ–¹æ³•ã‚’é›»è©±ã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚",
          "ã€’550-0015 å¤§é˜ªåºœå¤§é˜ªå¸‚è¥¿åŒºå—å €æ±Ÿ2-10-2 æ—¥ç ”ãƒ“ãƒ«å†… åŠ è³€ãƒã‚¤ãƒ†ãƒƒã‚¯ä¿®ç†å—ä»˜ã‚»ãƒ³ã‚¿ãƒ¼",
          "TELï¼š06-6536-3911 / FAXï¼š06-6536-3677",
          "â€»åœ°åŸŸã«ã‚ˆã‚Šç•°ãªã‚‹å¯èƒ½æ€§ã‚ã‚Š"
        ],
        "MSI":[
          "<strong>MSI è£œè¶³æƒ…å ±</strong>",
          "ãƒ¡ãƒ¼ã‚«ãƒ¼ä¿®ç†ä¾é ¼ãƒ•ãƒ­ãƒ¼ï¼šå›åæ–¹æ³•ã‚’é›»è©±ã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚",
          "043-211-9215ï¼ˆã‚­ãƒ¤ãƒãƒ³MJ ITãƒ—ãƒ­ãƒ€ã‚¯ãƒˆä¿®ç†å—ä»˜ã‚»ãƒ³ã‚¿ãƒ¼ï¼‰"
        ]
      };
      const lines = extra[maker];
      if(lines){
        panel.append(cardResult("warn","è£œè¶³æƒ…å ±ï¼ˆ" + maker + "ï¼‰", lines.map(x=>x)));
      }
    }

    // --- Update history rendering ---
    function renderHistory(){
      const tbody = $("#historyTable tbody");
      tbody.innerHTML = "";
      if(!Array.isArray(UPDATE_LOG)){
        tbody.innerHTML = `<tr><td colspan="4" class="muted">update_log.json ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€å½¢å¼ãŒä¸æ­£ã§ã™ã€‚</td></tr>`;
        return;
      }
      UPDATE_LOG.forEach(row=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${escapeHtml(row.date||"-")}</td>
                        <td>${escapeHtml(row.store||"-")}</td>
                        <td>${escapeHtml(row.name||"-")}</td>
                        <td>${escapeHtml(row.note||"-")}</td>`;
        tbody.append(tr);
      });
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[m]));
    }

    // --- Startup ---
    loadAll();
  </script>
</body>
</html>
